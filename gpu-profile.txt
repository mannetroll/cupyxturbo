 Checking CuPy...
OS                           : Windows-10-10.0.19045-SP0
Python Version               : 3.13.11
CuPy Version                 : 13.6.0
CuPy Platform                : NVIDIA CUDA
NumPy Version                : 2.4.0
SciPy Version                : 1.16.3
Cython Build Version         : 3.0.12
Cython Runtime Version       : None
CUDA Root                    : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v13.1
nvcc PATH                    : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v13.1\bin\nvcc.EXE
CUDA Build Version           : 13000
CUDA Driver Version          : 13010
CUDA Runtime Version         : 13000 (linked to CuPy) / 13010 (locally installed)
CUDA Extra Include Dirs      : []
cuBLAS Version               : (available)
cuFFT Version                : 12100
cuRAND Version               : 10401
cuSOLVER Version             : (12, 0, 7)
cuSPARSE Version             : (available)
NVRTC Version                : (13, 1)
Thrust Version               : 200800
CUB Build Version            : 200800
Jitify Build Version         : 1a0ca0e
cuDNN Build Version          : None
cuDNN Version                : None
NCCL Build Version           : None
NCCL Runtime Version         : None
cuTENSOR Version             : None
cuSPARSELt Build Version     : None
Device 0 Name                : NVIDIA GeForce RTX 3090
Device 0 Compute Capability  : 86
Device 0 PCI Bus ID          : 0000:01:00.0
 Checking CuPy...
OS                           : Windows-10-10.0.19045-SP0
Python Version               : 3.13.11
CuPy Version                 : 13.6.0
CuPy Platform                : NVIDIA CUDA
NumPy Version                : 2.4.0
SciPy Version                : 1.16.3
Cython Build Version         : 3.0.12
Cython Runtime Version       : None
CUDA Root                    : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v13.1
nvcc PATH                    : C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v13.1\bin\nvcc.EXE
CUDA Build Version           : 13000
CUDA Driver Version          : 13010
CUDA Runtime Version         : 13000 (linked to CuPy) / 13010 (locally installed)
CUDA Extra Include Dirs      : []
cuBLAS Version               : (available)
cuFFT Version                : 12100
cuRAND Version               : 10401
cuSOLVER Version             : (12, 0, 7)
cuSPARSE Version             : (available)
NVRTC Version                : (13, 1)
Thrust Version               : 200800
CUB Build Version            : 200800
Jitify Build Version         : 1a0ca0e
cuDNN Build Version          : None
cuDNN Version                : None
NCCL Build Version           : None
NCCL Runtime Version         : None
cuTENSOR Version             : None
cuSPARSELt Build Version     : None
Device 0 Name                : NVIDIA GeForce RTX 3090
Device 0 Compute Capability  : 86
Device 0 PCI Bus ID          : 0000:01:00.0
--- RUN DNS ---
 N   = 1024
 Re  = 10000.0
 K0  = 10.0
 Steps = 10001
 CFL  = 0.75
 requested = gpu
 backend:  gpu
 workers (CPU): 5
FFT plan_mod: cupyx.scipy.fft
--- INITIALIZING SciPy/CuPy --- 2026-01-03 21:32
 N=1024, K0=10, Re=10000.0
Generate isotropic random spectrum...
z=0/1024
z=1000/1024
Compute averages A(1..7), E110, Q2, W2, VISC...
 N           =        1024
 Reynolds n. =       1e+04
 K0          =          10
 Energy      =      0.9968
 WiWi        =    100.0000
 Epsilon     =      0.0997
 a11         =     -0.0000
 e11         =     -0.0000
 Time scale  =           5
 Kolmogorov  =      0.0100
 Viscosity   =      0.0010
 dx/Kol.     =      0.6146
 2Pi/Nlamda  =     18.7245
 2Pi/Lux     =     22.2496
 2Pi/Luz     =     38.5380
 2Pi/Lwx     =     38.5380
 2Pi/Lwz     =     22.2496
 Deps.       =      0.0397
 Ceps2       =      1.9936
 E1          =      1.0000
 E3          =      1.0000
 PAO seed    =        1983
 PAO initialization OK. VISC=0.0009968169
 effective = gpu (xp = cupy)
 scipy.fft workers in-context = 1
 [NEXTDT INIT] CFLM=   666.0746 DT=  0.0003584 CN=  1.0000000
 Initial DT=  0.0003584 CN=  1.0000000
 ITERATION      1 T=0.0003584169 DT=0.00035843 CN=1.00004586
 ITERATION    100 T=0.0363059607 DT=0.00036914 CN=1.00038089
 ITERATION    200 T=0.0739690524 DT=0.00038470 CN=1.00043868
 ITERATION    300 T=0.1131380663 DT=0.00039448 CN=0.99997353
 ITERATION    400 T=0.1527099136 DT=0.00039850 CN=1.00021157
 ITERATION    500 T=0.1931656620 DT=0.00041252 CN=1.00045721
 ITERATION    600 T=0.2354712800 DT=0.00043027 CN=0.99958555
 ITERATION    700 T=0.2773100179 DT=0.00040781 CN=0.99957687
 ITERATION    800 T=0.3173500123 DT=0.00039403 CN=0.99972282
 ITERATION    900 T=0.3563232190 DT=0.00038625 CN=0.99986374
 ITERATION   1000 T=0.3947971147 DT=0.00038425 CN=1.00003019
 ITERATION   1100 T=0.4334098314 DT=0.00038939 CN=1.00023504
 ITERATION   1200 T=0.4724741281 DT=0.00038959 CN=0.99994650
 ITERATION   1300 T=0.5114274889 DT=0.00039034 CN=1.00007560
 ITERATION   1400 T=0.5507061433 DT=0.00039622 CN=1.00021553
 ITERATION   1500 T=0.5907756344 DT=0.00040269 CN=0.99997370
 ITERATION   1600 T=0.6310130901 DT=0.00040264 CN=1.00004336
 ITERATION   1700 T=0.6714249405 DT=0.00040624 CN=1.00013317
 ITERATION   1800 T=0.7123187910 DT=0.00040668 CN=0.99934614
 ITERATION   1900 T=0.7518143559 DT=0.00038451 CN=0.99955024
 ITERATION   2000 T=0.7895159609 DT=0.00037057 CN=0.99971288
 ITERATION   2100 T=0.8261403912 DT=0.00036261 CN=0.99982570
 ITERATION   2200 T=0.8621504388 DT=0.00035783 CN=0.99988400
 ITERATION   2300 T=0.8977089847 DT=0.00035306 CN=0.99984004
 ITERATION   2400 T=0.9326890169 DT=0.00034600 CN=0.99976085
 ITERATION   2500 T=0.9667848643 DT=0.00033503 CN=0.99964263
 ITERATION   2600 T=0.9997163080 DT=0.00032373 CN=0.99967784
 ITERATION   2700 T=1.0316033475 DT=0.00031427 CN=0.99974410
 ITERATION   2800 T=1.0626593838 DT=0.00030722 CN=0.99981208
 ITERATION   2900 T=1.0931484027 DT=0.00030302 CN=0.99990417
 ITERATION   3000 T=1.1233674130 DT=0.00030189 CN=1.00001135
 ITERATION   3100 T=1.1536329624 DT=0.00030397 CN=1.00011892
 ITERATION   3200 T=1.1842650009 DT=0.00030928 CN=1.00022750
 ITERATION   3300 T=1.2155870429 DT=0.00031777 CN=1.00032390
 ITERATION   3400 T=1.2479086549 DT=0.00032924 CN=1.00038391
 ITERATION   3500 T=1.2815038918 DT=0.00034316 CN=1.00043464
 ITERATION   3600 T=1.3165894593 DT=0.00035899 CN=1.00046524
 ITERATION   3700 T=1.3532987190 DT=0.00037524 CN=1.00041582
 ITERATION   3800 T=1.3915130606 DT=0.00038821 CN=1.00025797
 ITERATION   3900 T=1.4307473322 DT=0.00039592 CN=1.00015719
 ITERATION   4000 T=1.4706184560 DT=0.00040132 CN=1.00012309
 ITERATION   4100 T=1.5109607814 DT=0.00040519 CN=1.00006665
 ITERATION   4200 T=1.5515480291 DT=0.00040595 CN=0.99997232
 ITERATION   4300 T=1.5920532192 DT=0.00040381 CN=0.99993182
 ITERATION   4400 T=1.6322877352 DT=0.00040092 CN=0.99994009
 ITERATION   4500 T=1.6722815795 DT=0.00039924 CN=0.99997783
 ITERATION   4600 T=1.7122040317 DT=0.00039956 CN=1.00003320
 ITERATION   4700 T=1.7522641407 DT=0.00040202 CN=1.00008725
 ITERATION   4800 T=1.7926728899 DT=0.00040654 CN=1.00013274
 ITERATION   4900 T=1.8336316898 DT=0.00041298 CN=1.00017745
 ITERATION   5000 T=1.8753027421 DT=0.00042065 CN=1.00018516
 ITERATION   5100 T=1.9177567783 DT=0.00042845 CN=1.00018106
 ITERATION   5200 T=1.9609627323 DT=0.00043563 CN=1.00015788
 ITERATION   5300 T=2.0048622004 DT=0.00044238 CN=1.00015630
 ITERATION   5400 T=2.0494269016 DT=0.00044898 CN=1.00014193
 ITERATION   5500 T=2.0946479428 DT=0.00045549 CN=1.00014266
 ITERATION   5600 T=2.1405071666 DT=0.00046166 CN=1.00012578
 ITERATION   5700 T=2.1869399468 DT=0.00046682 CN=1.00009532
 ITERATION   5800 T=2.2332088396 DT=0.00045678 CN=0.99978474
 ITERATION   5900 T=2.2785039585 DT=0.00045012 CN=0.99992512
 ITERATION   6000 T=2.3234400827 DT=0.00044955 CN=1.00004560
 ITERATION   6100 T=2.3685974954 DT=0.00045467 CN=1.00018739
 ITERATION   6200 T=2.4145826289 DT=0.00046641 CN=1.00033086
 ITERATION   6300 T=2.4613646219 DT=0.00046746 CN=0.99997680
 ITERATION   6400 T=2.5080972331 DT=0.00046737 CN=1.00000656
 ITERATION   6500 T=2.5548624328 DT=0.00046803 CN=1.00001055
 ITERATION   6600 T=2.6017070422 DT=0.00046882 CN=1.00001192
 ITERATION   6700 T=2.6486011141 DT=0.00046887 CN=0.99998220
 ITERATION   6800 T=2.6954308597 DT=0.00046743 CN=0.99994669
 ITERATION   6900 T=2.7420327833 DT=0.00046434 CN=0.99992515
 ITERATION   7000 T=2.7882694438 DT=0.00046028 CN=0.99990950
 ITERATION   7100 T=2.8340965549 DT=0.00045630 CN=0.99992058
 ITERATION   7200 T=2.8795610351 DT=0.00045311 CN=0.99994034
 ITERATION   7300 T=2.9247535011 DT=0.00045086 CN=0.99995927
 ITERATION   7400 T=2.9697582258 DT=0.00044931 CN=0.99996879
 ITERATION   7500 T=3.0146252100 DT=0.00044803 CN=0.99997058
 ITERATION   7600 T=3.0593579805 DT=0.00044657 CN=0.99996576
 ITERATION   7700 T=3.1039415933 DT=0.00044513 CN=0.99997294
 ITERATION   7800 T=3.1484056489 DT=0.00044431 CN=0.99999371
 ITERATION   7900 T=3.1928521491 DT=0.00044493 CN=1.00003426
 ITERATION   8000 T=3.2374615651 DT=0.00044772 CN=1.00008860
 ITERATION   8100 T=3.2824848051 DT=0.00045331 CN=1.00015639
 ITERATION   8200 T=3.3282239637 DT=0.00046209 CN=1.00022305
 ITERATION   8300 T=3.3749991450 DT=0.00047403 CN=1.00028604
 ITERATION   8400 T=3.4231087664 DT=0.00048870 CN=1.00032249
 ITERATION   8500 T=3.4727849910 DT=0.00050521 CN=1.00034016
 ITERATION   8600 T=3.5241540712 DT=0.00052236 CN=1.00032541
 ITERATION   8700 T=3.5772227324 DT=0.00053906 CN=1.00030178
 ITERATION   8800 T=3.6316440763 DT=0.00054664 CN=1.00007567
 ITERATION   8900 T=3.6865473802 DT=0.00055191 CN=1.00011926
 ITERATION   9000 T=3.7414984674 DT=0.00054372 CN=0.99976722
 ITERATION   9100 T=3.7952121004 DT=0.00052988 CN=0.99972293
 ITERATION   9200 T=3.8474843907 DT=0.00051558 CN=0.99973190
 ITERATION   9300 T=3.8983834889 DT=0.00050251 CN=0.99975762
 ITERATION   9400 T=3.9480541751 DT=0.00049109 CN=0.99978751
 ITERATION   9500 T=3.9966765388 DT=0.00048161 CN=0.99982532
 ITERATION   9600 T=4.0444561475 DT=0.00047430 CN=0.99986933
 ITERATION   9700 T=4.0916218274 DT=0.00046940 CN=0.99992394
 ITERATION   9800 T=4.1384287551 DT=0.00046720 CN=0.99998642
 ITERATION   9900 T=4.1851637036 DT=0.00046804 CN=1.00004710
 ITERATION  10000 T=4.2321491352 DT=0.00047231 CN=1.00013265
 ITERATION  10001 T=4.2326214440 DT=0.00047237 CN=1.00013308
 Elapsed CPU time for 10001 steps (s) =  25.0129
 Final T= 4.23262  CN= 1.00013  DT=0.000472372
 FPS = 399.834
[3m  C:\Users\tobbe\python\cupyxturbo\scipyturbo\turbo_simulator.py: % of time =  [0m
[3m                       100.00% (30.119s) out of 30.119s.                       [0m
+-----------------------------------------------------------------------------+
|[1m       [0m|[1;34mTime[0m[1m   [0m[1m [0m|[1;34m––––––[0m[1m [0m|[1;34m––––––[0m[1m [0m|[1m                                           [0m[1m [0m|
|[1m [0m[1;2mLine[0m[1m [0m[1m [0m|[1;3;34mPython[0m[1m [0m[1m [0m|[1;3;34mnative[0m[1m [0m|[1;3;34msystem[0m[1m [0m|[1mC:\Users\tobbe\python\cupyxturbo\scipyturb…[0m[1m [0m|
|-------+--------+-------+-------+--------------------------------------------|
|[2m [0m[2m    1[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m"""[0m[40m                                        [0m |
|[2m [0m[2m    2[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mturbo_simulator.py â€” 2D Homogeneous Turbu[0m |
|[2m [0m[2m    3[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m    4[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mThis is a structural port of dns_all.cu to [0m |
|[2m [0m[2m    5[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m    6[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mKey ideas kept from the CUDA version:[0m[40m      [0m |
|[2m [0m[2m    7[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ DnsState structure mirrors DnsDeviceS[0m |
|[2m [0m[2m    8[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ UR (compact)  : shape (NZ, NX, 3)   â[0m |
|[2m [0m[2m    9[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ UC (compact)  : shape (NZ, NK, 3)   â[0m |
|[2m [0m[2m   10[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ UR_full (3/2) : shape (3, NZ_full, NX[0m |
|[2m [0m[2m   11[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ UC_full (3/2) : shape (3, NZ_full, NK[0m |
|[2m [0m[2m   12[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ om2, fnm1     : shape (NZ, NX_half) â[0m |
|[2m [0m[2m   13[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ alfa[NX_half], gamma[NZ]           â€[0m |
|[2m [0m[2m   14[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ Time loop     : STEP2B â†’ STEP3 â†’ [0m |
|[2m [0m[2m   15[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   16[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mBackends:[0m[40m                                  [0m |
|[2m [0m[2m   17[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ CPU:  SciPy[0m[40m                          [0m |
|[2m [0m[2m   18[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ GPU:  CuPy (if installed); same API u[0m |
|[2m [0m[2m   19[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   20[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mThis is now a faithful structural port of d[0m |
|[2m [0m[2m   21[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   22[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ dnsCudaPaoHostInit  â†’ dns_pao_host_[0m |
|[2m [0m[2m   23[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ dnsCudaCalcom       â†’ dns_calcom_fr[0m |
|[2m [0m[2m   24[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ dnsCudaStep2A/2B/3  â†’ dns_step2a / [0m |
|[2m [0m[2m   25[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m  â€¢ next_dt_gpu         â†’ next_dt[0m[40m      [0m |
|[2m [0m[2m   26[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   27[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mThe 3/2 de-aliasing, Crankâ€“Nicolson updat[0m |
|[2m [0m[2m   28[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40mformulas follow the CUDA kernels line-by-li[0m |
|[2m [0m[2m   29[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m"""[0m[40m                                        [0m |
|[2m [0m[2m   30[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mfrom[0m[37;40m [0m[37;40mcontextlib[0m[37;40m [0m[95;40mimport[0m[37;40m [0m[37;40mnullcontext[0m[40m         [0m |
|[2m [0m[2m   31[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40mtime[0m[40m                                [0m |
|[2m [0m[2m   32[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40mdatetime[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40m_dt[0m[40m                     [0m |
|[2m [0m[2m   33[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40mmath[0m[40m                                [0m |
|[2m [0m[2m   34[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40msys[0m[40m                                 [0m |
|[2m [0m[2m   35[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mfrom[0m[37;40m [0m[37;40mdataclasses[0m[37;40m [0m[95;40mimport[0m[37;40m [0m[37;40mdataclass[0m[40m          [0m |
|[2m [0m[2m   36[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mfrom[0m[37;40m [0m[37;40mtyping[0m[37;40m [0m[95;40mimport[0m[37;40m [0m[37;40mLiteral[0m[40m                 [0m |
|[2m [0m[2m   37[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   38[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40mnumpy[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40m_np[0m[40m                        [0m |
|[2m [0m[2m   39[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   40[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mtry[0m[37;40m:[0m[40m                                       [0m |
|[2m [0m[2m   41[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m Checking CuPy...[0m[31;40m"[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m   42[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mimport[0m[37;40m [0m[37;40mcupy[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40m_cp[0m[40m                     [0m |
|[2m [0m[2m   43[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m_cp[0m[36;40m.[0m[37;40mshow_config[0m[37;40m([0m[37;40m)[0m[40m                      [0m |
|[2m [0m[2m   44[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mexcept[0m[37;40m [0m[1;90;40mException[0m[37;40m:[0m[37;40m  [0m[34;40m# CuPy is optional[0m[40m      [0m |
|[2m [0m[2m   45[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m_cp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                             [0m |
|[2m [0m[2m   46[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m CuPy not installed[0m[31;40m"[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m   47[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   48[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[95;40mimport[0m[37;40m [0m[37;40mnumpy[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40mnp[0m[37;40m  [0m[34;40m# in addition to your e[0m |
|[2m [0m[2m   49[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   50[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m   51[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# ONLY FFT selection (CPU: scipy.fft, GPU: [0m |
|[2m [0m[2m   52[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m   53[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mtry[0m[37;40m:[0m[40m                                       [0m |
|[2m [0m[2m   54[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mimport[0m[37;40m [0m[37;40mscipy[0m[37;40m.[0m[37;40mfft[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40m_spfft[0m[37;40m  [0m[34;40m# type: ign[0m |
|[2m [0m[2m   55[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mexcept[0m[37;40m [0m[1;90;40mException[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m   56[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m_spfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                          [0m |
|[2m [0m[2m   57[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   58[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mtry[0m[37;40m:[0m[40m                                       [0m |
|[2m [0m[2m   59[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mimport[0m[37;40m [0m[37;40mcupyx[0m[37;40m.[0m[37;40mscipy[0m[37;40m.[0m[37;40mfft[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40m_cpfft[0m[37;40m  [0m[34;40m# typ[0m |
|[2m [0m[2m   60[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mexcept[0m[37;40m [0m[1;90;40mException[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m   61[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m_cpfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                          [0m |
|[2m [0m[2m   62[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   63[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   64[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40m_fft_mod_for_state[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[31;40m"[0m[31;40mDnsState[0m[31;40m"[0m[37;40m)[0m[37;40m:[0m[40m     [0m |
|[2m [0m[2m   65[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m   66[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    ONLY FFT selection:[0m[40m                    [0m |
|[2m [0m[2m   67[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      - CPU: scipy.fft[0m[40m                     [0m |
|[2m [0m[2m   68[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      - GPU: cupyx.scipy.fft (fallback to c[0m |
|[2m [0m[2m   69[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m   70[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m   71[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40m_cpfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m   72[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mreturn[0m[37;40m [0m[37;40m_cpfft[0m[40m                  [0m |
|[2m [0m[2m   73[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[36;40m.[0m[37;40mfft[0m[40m                    [0m |
|[2m [0m[2m   74[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40m_spfft[0m[40m                          [0m |
|[2m [0m[2m   75[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   76[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m   77[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Fortran-style random generator used in PA[0m |
|[2m [0m[2m   78[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m   79[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mfrand[0m[37;40m([0m[37;40mseed_list[0m[37;40m)[0m[37;40m:[0m[40m                      [0m |
|[2m [0m[2m   80[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m   81[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Port of the Fortran LCG used in PAO:[0m[40m   [0m |
|[2m [0m[2m   82[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   83[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      IMM = 420029[0m[40m                         [0m |
|[2m [0m[2m   84[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      IT  = 2017[0m[40m                           [0m |
|[2m [0m[2m   85[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      ID  = 5011[0m[40m                           [0m |
|[2m [0m[2m   86[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   87[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      seed = (seed*IMM + IT) mod ID[0m[40m        [0m |
|[2m [0m[2m   88[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      r    = seed / ID[0m[40m                     [0m |
|[2m [0m[2m   89[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   90[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    `seed_list` is a 1-element list to mimi[0m |
|[2m [0m[2m   91[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m   92[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mIMM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m420029[0m[40m                           [0m |
|[2m [0m[2m   93[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mIT[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2017[0m[40m                              [0m |
|[2m [0m[2m   94[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mID[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m5011[0m[40m                              [0m |
|[2m [0m[2m   95[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   96[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mseed_list[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mseed_list[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mIMM[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mIT[0m |
|[2m [0m[2m   97[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mseed_list[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mID[0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m   98[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m   99[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  100[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  101[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Backend selection: xp = np (CPU) or cp (G[0m |
|[2m [0m[2m  102[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  103[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mget_xp[0m[37;40m([0m[37;40mbackend[0m[37;40m:[0m[37;40m [0m[37;40mLiteral[0m[37;40m[[0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m |
|[2m [0m[2m  104[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  105[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    backend = "gpu"  â†’ force CuPy cuFFT ([0m |
|[2m [0m[2m  106[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    backend = "cpu"  â†’ force SciPy FFT[0m[40m   [0m |
|[2m [0m[2m  107[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    backend = "auto" â†’ use CuPy if availa[0m |
|[2m [0m[2m  108[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  109[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Auto-select: try GPU first[0m[40m           [0m |
|[2m [0m[2m  110[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  111[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40m_cp[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                [0m |
|[2m [0m[2m  112[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mreturn[0m[37;40m [0m[37;40m_cp[0m[40m                     [0m |
|[2m [0m[2m  113[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[37;40m_np[0m[40m                         [0m |
|[2m [0m[2m  114[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  115[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Explicit GPU / CPU selection[0m[40m         [0m |
|[2m [0m[2m  116[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m                   [0m |
|[2m [0m[2m  117[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40m_cp[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  118[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mraise[0m[37;40m [0m[1;90;40mRuntimeError[0m[37;40m([0m[31;40m"[0m[31;40mCuPy is not[0m |
|[2m [0m[2m  119[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[37;40m_cp[0m[40m                         [0m |
|[2m [0m[2m  120[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  121[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# backend == "cpu"[0m[40m                     [0m |
|[2m [0m[2m  122[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40m_np[0m[40m                             [0m |
|[2m [0m[2m  123[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  124[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  125[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  126[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Fortran-style random generator used in PA[0m |
|[2m [0m[2m  127[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  128[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  129[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mclass[0m[37;40m [0m[36;40mFrand[0m[37;40m:[0m[40m                               [0m |
|[2m [0m[2m  130[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  131[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Port of the tiny LCG from dns_all.cu:[0m[40m  [0m |
|[2m [0m[2m  132[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  133[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      IMM = 420029[0m[40m                         [0m |
|[2m [0m[2m  134[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      IT  = 2017[0m[40m                           [0m |
|[2m [0m[2m  135[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      ID  = 5011[0m[40m                           [0m |
|[2m [0m[2m  136[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  137[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      seed = (seed*IMM + IT) % ID[0m[40m          [0m |
|[2m [0m[2m  138[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      r    = seed / ID[0m[40m                     [0m |
|[2m [0m[2m  139[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  140[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mIMM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m420029[0m[40m                           [0m |
|[2m [0m[2m  141[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mIT[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2017[0m[40m                              [0m |
|[2m [0m[2m  142[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mID[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m5011[0m[40m                              [0m |
|[2m [0m[2m  143[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  144[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mdef[0m[37;40m [0m[37;40m__init__[0m[37;40m([0m[95;40mself[0m[37;40m,[0m[37;40m [0m[37;40mseed[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m:[0m[40m     [0m |
|[2m [0m[2m  145[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mself[0m[36;40m.[0m[37;40mseed[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mseed[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m  146[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  147[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mdef[0m[37;40m [0m[37;40m__call__[0m[37;40m([0m[95;40mself[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[95;40mfloat[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m  148[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mself[0m[36;40m.[0m[37;40mseed[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[95;40mself[0m[36;40m.[0m[37;40mseed[0m[37;40m [0m[36;40m*[0m[37;40m [0m[95;40mself[0m[36;40m.[0m[37;40mIMM[0m[37;40m [0m[36;40m+[0m |
|[2m [0m[2m  149[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[95;40mself[0m[36;40m.[0m[37;40mseed[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[95;40msel[0m |
|[2m [0m[2m  150[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  151[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  152[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  153[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Python equivalent of dnsCudaDumpUCFullCsv[0m |
|[2m [0m[2m  154[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  155[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdump_uc_full_csv[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[31;40m"[0m[31;40mDnsState[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[37;40mUC_full[0m |
|[2m [0m[2m  156[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  157[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    CSV dumper compatible with step2a_debug[0m |
|[2m [0m[2m  158[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  159[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m        UC_full: (3, NZ_full, NK_full)  # [[0m |
|[2m [0m[2m  160[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  161[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    We print NX_full rows, NZ_full columns:[0m |
|[2m [0m[2m  162[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      - For i < 2*ND2:[0m[40m                     [0m |
|[2m [0m[2m  163[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m          kx       = i // 2[0m[40m                [0m |
|[2m [0m[2m  164[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m          imag_row = (i & 1) == 1[0m[40m          [0m |
|[2m [0m[2m  165[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m          value    = Re or Im of UC_full[co[0m |
|[2m [0m[2m  166[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      - For i >= 2*ND2, we print 0.0 (as in[0m |
|[2m [0m[2m  167[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  168[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[40m                            [0m |
|[2m [0m[2m  169[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[40m                    [0m |
|[2m [0m[2m  170[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                    [0m |
|[2m [0m[2m  171[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[40m                    [0m |
|[2m [0m[2m  172[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mND2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                           [0m |
|[2m [0m[2m  173[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  174[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Bring data to NumPy on CPU for printi[0m |
|[2m [0m[2m  175[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m  176[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC_local[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_np[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mUC_full[0m[36;40m.[0m[37;40mget[0m[37;40m([0m |
|[2m [0m[2m  177[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m  178[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC_local[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_np[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mUC_full[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  179[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  180[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mi[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNX_full[0m[37;40m)[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  181[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mrow_vals[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m[[0m[37;40m][0m[40m                      [0m |
|[2m [0m[2m  182[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  183[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40muse_mode[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mi[0m[37;40m [0m[36;40m<[0m[37;40m [0m[95;40m2[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mND2[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m  184[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40muse_mode[0m[37;40m:[0m[40m                       [0m |
|[2m [0m[2m  185[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mkx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mi[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[37;40m           [0m[34;40m# 0..ND2-[0m |
|[2m [0m[2m  186[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mimag_row[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mi[0m[37;40m [0m[36;40m&[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m1[0m[40m        [0m |
|[2m [0m[2m  187[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m  188[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mkx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                      [0m |
|[2m [0m[2m  189[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mimag_row[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mFalse[0m[37;40m  [0m[34;40m# unused[0m[40m     [0m |
|[2m [0m[2m  190[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  191[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNZ_full[0m[37;40m)[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m  192[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mif[0m[37;40m [0m[37;40muse_mode[0m[37;40m [0m[33;40mand[0m[37;40m [0m[37;40mkx[0m[37;40m [0m[36;40m<[0m[37;40m [0m[37;40mNK_full[0m[37;40m:[0m[40m  [0m |
|[2m [0m[2m  193[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[34;40m# SoA layout: [comp, z, kx][0m |
|[2m [0m[2m  194[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mv[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUC_local[0m[37;40m[[0m[37;40mcomp[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[37;40mkx[0m[37;40m][0m[40m  [0m |
|[2m [0m[2m  195[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mval[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mv[0m[36;40m.[0m[37;40mimag[0m[37;40m [0m[33;40mif[0m[37;40m [0m[37;40mimag_[0m |
|[2m [0m[2m  196[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40melse[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m  197[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mval[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                  [0m |
|[2m [0m[2m  198[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  199[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mrow_vals[0m[36;40m.[0m[37;40mappend[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m{[0m[37;40mval[0m[31;40m:[0m[31;40m10.5f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m |
|[2m [0m[2m  200[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  201[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m,[0m[31;40m"[0m[36;40m.[0m[37;40mjoin[0m[37;40m([0m[37;40mrow_vals[0m[37;40m)[0m[37;40m)[0m[40m          [0m |
|[2m [0m[2m  202[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  203[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m[CSV] Wrote UC_full, [0m[31;40m{[0m[37;40mNX_full[0m[31;40m}[0m[31;40mx[0m |
|[2m [0m[2m  204[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  205[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  206[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  207[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# DNS state  (Python equivalent of DnsDevic[0m |
|[2m [0m[2m  208[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  209[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  210[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m@dataclass[0m[40m                                 [0m |
|[2m [0m[2m  211[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mclass[0m[37;40m [0m[36;40mDnsState[0m[37;40m:[0m[40m                            [0m |
|[2m [0m[2m  212[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m                 [0m[34;40m# scipy or cupy[0m |
|[2m [0m[2m  213[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mbackend[0m[37;40m:[0m[37;40m [0m[95;40mstr[0m[37;40m            [0m[34;40m# "cpu" or "gpu[0m |
|[2m [0m[2m  214[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  215[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNbase[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m              [0m[34;40m# Fortran NX=NZ[0m |
|[2m [0m[2m  216[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                                [0m |
|[2m [0m[2m  217[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                                [0m |
|[2m [0m[2m  218[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                                [0m |
|[2m [0m[2m  219[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  220[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                           [0m |
|[2m [0m[2m  221[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                           [0m |
|[2m [0m[2m  222[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[40m                           [0m |
|[2m [0m[2m  223[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  224[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mRe[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[40m                              [0m |
|[2m [0m[2m  225[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK0[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[40m                              [0m |
|[2m [0m[2m  226[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvisc[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m             [0m[34;40m# viscosity[0m[40m    [0m |
|[2m [0m[2m  227[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcflnum[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m           [0m[34;40m# CFL target[0m[40m   [0m |
|[2m [0m[2m  228[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mseed_init[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1[0m[40m                     [0m |
|[2m [0m[2m  229[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft_workers[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1[0m[40m                   [0m |
|[2m [0m[2m  230[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  231[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Cached FFT module (scipy.fft or cupyx[0m |
|[2m [0m[2m  232[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                        [0m |
|[2m [0m[2m  233[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  234[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Reusable cuFFT plans (GPU only)[0m[40m      [0m |
|[2m [0m[2m  235[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft_plan_rfft2_ur_full[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m     [0m |
|[2m [0m[2m  236[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft_plan_irfft2_uc01[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m       [0m |
|[2m [0m[2m  237[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  238[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Precomputed grid constants for CFL co[0m |
|[2m [0m[2m  239[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40minv_dx[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                    [0m |
|[2m [0m[2m  240[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  241[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# CFL scratch to avoid per-step allocat[0m |
|[2m [0m[2m  242[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcfl_tmp[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                    [0m |
|[2m [0m[2m  243[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcfl_absw[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                   [0m |
|[2m [0m[2m  244[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  245[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Time integration[0m[40m                     [0m |
|[2m [0m[2m  246[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mt[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                         [0m |
|[2m [0m[2m  247[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdt[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                        [0m |
|[2m [0m[2m  248[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcn[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[40m                        [0m |
|[2m [0m[2m  249[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcnm1[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                      [0m |
|[2m [0m[2m  250[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mit[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0[0m[40m                            [0m |
|[2m [0m[2m  251[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  252[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Spectral wavenumber vectors[0m[40m          [0m |
|[2m [0m[2m  253[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40malfa[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m        [0m[34;40m# shape (NX_hal[0m |
|[2m [0m[2m  254[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m       [0m[34;40m# shape (NZ,)[0m[40m  [0m |
|[2m [0m[2m  255[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  256[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Compact grid (AoS)[0m[40m                   [0m |
|[2m [0m[2m  257[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mur[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m          [0m[34;40m# shape (NZ, NX[0m |
|[2m [0m[2m  258[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m          [0m[34;40m# shape (NZ, NK[0m |
|[2m [0m[2m  259[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  260[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Full 3/2 grid (SoA)[0m[40m                  [0m |
|[2m [0m[2m  261[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mur_full[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m     [0m[34;40m# shape (3, NZ_[0m |
|[2m [0m[2m  262[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_full[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m     [0m[34;40m# shape (3, NZ_[0m |
|[2m [0m[2m  263[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  264[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Vorticity and non-linear history[0m[40m     [0m |
|[2m [0m[2m  265[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mom2[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m         [0m[34;40m# shape (NZ, NX[0m |
|[2m [0m[2m  266[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfnm1[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m        [0m[34;40m# shape (NZ, NX[0m |
|[2m [0m[2m  267[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  268[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mscratch1[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                   [0m |
|[2m [0m[2m  269[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mscratch2[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                   [0m |
|[2m [0m[2m  270[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  271[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Precomputed index grids for STEP3 (av[0m |
|[2m [0m[2m  272[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_z_indices[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m            [0m |
|[2m [0m[2m  273[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_kx_indices[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m           [0m |
|[2m [0m[2m  274[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_z_spec[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m               [0m |
|[2m [0m[2m  275[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  276[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# STEP3 scratch buffers & constants (av[0m |
|[2m [0m[2m  277[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_uc1_th[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m               [0m |
|[2m [0m[2m  278[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_uc2_th[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m               [0m |
|[2m [0m[2m  279[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_uc3_th[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m               [0m |
|[2m [0m[2m  280[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  281[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_K2[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m          [0m[34;40m# float32[0m |
|[2m [0m[2m  282[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_GA[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m          [0m[34;40m# float32[0m |
|[2m [0m[2m  283[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_G2mA2[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m       [0m[34;40m# float32[0m |
|[2m [0m[2m  284[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_invK2_sub[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m   [0m[34;40m# float32[0m |
|[2m [0m[2m  285[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  286[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_ARG[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m         [0m[34;40m# float32[0m |
|[2m [0m[2m  287[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_DEN[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m         [0m[34;40m# float32[0m |
|[2m [0m[2m  288[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_NUM[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m         [0m[34;40m# complex[0m |
|[2m [0m[2m  289[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  290[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_mask_ix0[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m    [0m[34;40m# bool (N[0m |
|[2m [0m[2m  291[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstep3_divxz[0m[37;40m:[0m[37;40m [0m[95;40many[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[37;40m       [0m[34;40m# float32[0m |
|[2m [0m[2m  292[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  293[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mdef[0m[37;40m [0m[37;40msync[0m[37;40m([0m[95;40mself[0m[37;40m)[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  294[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[31;40m"""For a CuPy backend, force synchr[0m |
|[2m [0m[2m  295[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[95;40mself[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m          [0m |
|[2m [0m[2m  296[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mself[0m[36;40m.[0m[37;40mxp[0m[36;40m.[0m[37;40mcuda[0m[36;40m.[0m[37;40mStream[0m[36;40m.[0m[37;40mnull[0m[36;40m.[0m[37;40msynchr[0m |
|[2m [0m[2m  297[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  298[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  299[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  300[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Helper to create a DnsState (dnsCudaInit [0m |
|[2m [0m[2m  301[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  302[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  303[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mcreate_dns_state[0m[37;40m([0m[40m                      [0m |
|[2m [0m[2m  304[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m8[0m[37;40m,[0m[40m                            [0m |
|[2m [0m[2m  305[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mRe[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1e5[0m[37;40m,[0m[40m                       [0m |
|[2m [0m[2m  306[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK0[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m100.0[0m[37;40m,[0m[40m                     [0m |
|[2m [0m[2m  307[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFL[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.75[0m[37;40m,[0m[40m                     [0m |
|[2m [0m[2m  308[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mbackend[0m[37;40m:[0m[37;40m [0m[37;40mLiteral[0m[37;40m[[0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[37;40m][0m[37;40m [0m |
|[2m [0m[2m  309[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mseed[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1[0m[37;40m,[0m[40m                         [0m |
|[2m [0m[2m  310[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[37;40mDnsState[0m[37;40m:[0m[40m                             [0m |
|[2m [0m[2m  311[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mget_xp[0m[37;40m([0m[37;40mbackend[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m  312[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  313[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  314[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40meffective_backend[0m[37;40m [0m[36;40m=[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m [0m[33;40mif[0m[37;40m [0m[37;40m([0m[37;40m_cp[0m[37;40m [0m[33;40mi[0m |
|[2m [0m[2m  315[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m  316[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40meffective_backend[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mbackend[0m[40m        [0m |
|[2m [0m[2m  317[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  318[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m backend:  [0m[31;40m{[0m[37;40mbackend[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m         [0m |
|[2m [0m[2m  319[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNbase[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                              [0m |
|[2m [0m[2m  320[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                                 [0m |
|[2m [0m[2m  321[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                                 [0m |
|[2m [0m[2m  322[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  323[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Your CUDA code uses 3*N/2 (full 3/2 g[0m |
|[2m [0m[2m  324[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNX[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                  [0m |
|[2m [0m[2m  325[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNZ[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                  [0m |
|[2m [0m[2m  326[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNX_full[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[40m             [0m |
|[2m [0m[2m  327[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  328[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Compact spectral NK:[0m[40m                 [0m |
|[2m [0m[2m  329[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# For the original PAO/Calcom you used [0m |
|[2m [0m[2m  330[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNX[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m4[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[40m                   [0m |
|[2m [0m[2m  331[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  332[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNX[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                      [0m |
|[2m [0m[2m  333[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  334[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Viscosity: in your original Fortran/C[0m |
|[2m [0m[2m  335[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# from PAO/Calcom; here we keep a stand[0m |
|[2m [0m[2m  336[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvisc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[37;40m [0m[36;40m/[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mRe[0m[37;40m)[0m[40m                 [0m |
|[2m [0m[2m  337[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  338[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mDnsState[0m[37;40m([0m[40m                      [0m |
|[2m [0m[2m  339[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mxp[0m[36;40m=[0m[37;40mxp[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  340[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mbackend[0m[36;40m=[0m[37;40meffective_backend[0m[37;40m,[0m[40m         [0m |
|[2m [0m[2m  341[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNbase[0m[36;40m=[0m[37;40mNbase[0m[37;40m,[0m[40m                       [0m |
|[2m [0m[2m  342[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNX[0m[36;40m=[0m[37;40mNX[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  343[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNZ[0m[36;40m=[0m[37;40mNZ[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  344[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNK[0m[36;40m=[0m[37;40mNK[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  345[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNX_full[0m[36;40m=[0m[37;40mNX_full[0m[37;40m,[0m[40m                   [0m |
|[2m [0m[2m  346[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNZ_full[0m[36;40m=[0m[37;40mNZ_full[0m[37;40m,[0m[40m                   [0m |
|[2m [0m[2m  347[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNK_full[0m[36;40m=[0m[37;40mNK_full[0m[37;40m,[0m[40m                   [0m |
|[2m [0m[2m  348[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mRe[0m[36;40m=[0m[37;40mRe[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  349[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mK0[0m[36;40m=[0m[37;40mK0[0m[37;40m,[0m[40m                             [0m |
|[2m [0m[2m  350[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mvisc[0m[36;40m=[0m[37;40mvisc[0m[37;40m,[0m[40m                         [0m |
|[2m [0m[2m  351[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mcflnum[0m[36;40m=[0m[37;40mCFL[0m[37;40m,[0m[40m                        [0m |
|[2m [0m[2m  352[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mseed_init[0m[36;40m=[0m[95;40mint[0m[37;40m([0m[37;40mseed[0m[37;40m)[0m[37;40m,[0m[40m               [0m |
|[2m [0m[2m  353[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mfft_workers[0m[36;40m=[0m[95;40m5[0m[37;40m,[0m[40m                     [0m |
|[2m [0m[2m  354[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m)[0m[40m                                      [0m |
|[2m [0m[2m  355[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m workers (CPU): [0m[31;40m{[0m[37;40mstate[0m[36;40m.[0m[37;40mfft_work[0m |
|[2m [0m[2m  356[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  357[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Cache FFT module for the chosen backe[0m |
|[2m [0m[2m  358[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_fft_mod_for_state[0m[37;40m([0m[37;40mstate[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  359[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  360[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Precompute inverse grid spacing (dx==[0m |
|[2m [0m[2m  361[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40minv_dx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mstate[0m[36;40m.[0m[37;40mNbase[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40m([0m[95;40m2.[0m |
|[2m [0m[2m  362[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  363[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Allocate arrays[0m[40m                      [0m |
|[2m [0m[2m  364[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mur[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX[0m[37;40m,[0m[37;40m [0m[95;40m3[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m |
|[2m [0m[2m  365[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40muc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNK[0m[37;40m,[0m[37;40m [0m[95;40m3[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m |
|[2m [0m[2m  366[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  367[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mur_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[95;40m3[0m[37;40m,[0m[37;40m [0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mN[0m |
|[2m [0m[2m  368[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40muc_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[95;40m3[0m[37;40m,[0m[37;40m [0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mN[0m |
|[2m [0m[2m  369[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  370[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# CFL scratch buffers (full 3/2 grid) t[0m |
|[2m [0m[2m  371[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mcfl_tmp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mNX_f[0m |
|[2m [0m[2m  372[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mcfl_absw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mNX_[0m |
|[2m [0m[2m  373[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  374[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mom2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdty[0m |
|[2m [0m[2m  375[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mfnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdt[0m |
|[2m [0m[2m  376[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  377[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40malfa[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNX_half[0m[37;40m,[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m |
|[2m [0m[2m  378[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mgamma[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mxp[0m[36;40m.[0m |
|[2m [0m[2m  379[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  380[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Reusable cuFFT plans (GPU only)[0m[40m      [0m |
|[2m [0m[2m  381[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m  382[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mplan_mod[0m[37;40m [0m[36;40m=[0m[37;40m [0m[33;40mNone[0m[40m                    [0m |
|[2m [0m[2m  383[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40m_cpfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m [0m[33;40mand[0m[37;40m [0m[95;40mhasattr[0m[37;40m([0m[37;40m_[0m |
|[2m [0m[2m  384[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mplan_mod[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_cpfft[0m[40m              [0m |
|[2m [0m[2m  385[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  386[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mplan_mod[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m  387[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[34;40m# Forward: rfft2 on real UR_ful[0m |
|[2m [0m[2m  388[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mstate[0m[36;40m.[0m[37;40mfft_plan_rfft2_ur_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m |
|[2m [0m[2m  389[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mstate[0m[36;40m.[0m[37;40mur_full[0m[37;40m,[0m[37;40m [0m[37;40maxes[0m[36;40m=[0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[95;40m2[0m[37;40m)[0m[37;40m,[0m |
|[2m [0m[2m  390[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40m)[0m[40m                              [0m |
|[2m [0m[2m  391[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[34;40m# Inverse: irfft2 on UC_full[0:[0m |
|[2m [0m[2m  392[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mstate[0m[36;40m.[0m[37;40mfft_plan_irfft2_uc01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mpl[0m |
|[2m [0m[2m  393[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mstate[0m[36;40m.[0m[37;40muc_full[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m][0m[37;40m,[0m[40m        [0m |
|[2m [0m[2m  394[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mshape[0m[36;40m=[0m[37;40m([0m[37;40mstate[0m[36;40m.[0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mstate[0m |
|[2m [0m[2m  395[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40maxes[0m[36;40m=[0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[95;40m2[0m[37;40m)[0m[37;40m,[0m[40m               [0m |
|[2m [0m[2m  396[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mvalue_type[0m[36;40m=[0m[31;40m"[0m[31;40mC2R[0m[31;40m"[0m[37;40m,[0m[40m          [0m |
|[2m [0m[2m  397[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40m)[0m[40m                              [0m |
|[2m [0m[2m  398[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  399[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mplan_mod[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  400[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40mFFT plan_mod: None[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  401[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m  402[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40mFFT plan_mod: [0m[31;40m{[0m[37;40mplan_mod[0m |
|[2m [0m[2m  403[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  404[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# PAO-style initialization (dnsCudaPaoH[0m |
|[2m [0m[2m  405[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdns_pao_host_init[0m[37;40m([0m[37;40mstate[0m[37;40m)[0m[40m               [0m |
|[2m [0m[2m  406[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  407[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# DT and CN will be initialized in run_[0m |
|[2m [0m[2m  408[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                         [0m |
|[2m [0m[2m  409[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mcn[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[40m                         [0m |
|[2m [0m[2m  410[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mcnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                       [0m |
|[2m [0m[2m  411[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  412[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mscratch1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m[37;40m)[0m |
|[2m [0m[2m  413[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mscratch2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m[37;40m)[0m |
|[2m [0m[2m  414[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  415[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Precompute index grids used in STEP3 [0m |
|[2m [0m[2m  416[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40mNZ[0m[40m                          [0m |
|[2m [0m[2m  417[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40mNX[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                [0m |
|[2m [0m[2m  418[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_z_indices[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40marange[0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40md[0m |
|[2m [0m[2m  419[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_kx_indices[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40marange[0m[37;40m([0m[37;40mNX_h[0m |
|[2m [0m[2m  420[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNZ[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                      [0m |
|[2m [0m[2m  421[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mzi[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_z_indices[0m[40m             [0m |
|[2m [0m[2m  422[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_z_spec[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mwhere[0m[37;40m([0m[40m         [0m |
|[2m [0m[2m  423[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mzi[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mNZ_half[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m,[0m[40m               [0m |
|[2m [0m[2m  424[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mzi[0m[37;40m,[0m[40m                                [0m |
|[2m [0m[2m  425[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mzi[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mNZ_half[0m[37;40m,[0m[40m                      [0m |
|[2m [0m[2m  426[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40m)[0m[40m                                      [0m |
|[2m [0m[2m  427[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  428[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# STEP3: preallocate gather buffers for[0m |
|[2m [0m[2m  429[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_uc1_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_h[0m |
|[2m [0m[2m  430[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_uc2_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_h[0m |
|[2m [0m[2m  431[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_uc3_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_h[0m |
|[2m [0m[2m  432[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  433[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# STEP3: precompute constant spectral g[0m |
|[2m [0m[2m  434[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40malfa[0m[37;40m[[0m[33;40mNone[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m          [0m[34;40m# (1,[0m |
|[2m [0m[2m  435[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mstate[0m[36;40m.[0m[37;40mgamma[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[33;40mNone[0m[37;40m][0m[37;40m         [0m[34;40m# (NZ[0m |
|[2m [0m[2m  436[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40max2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max[0m[40m                          [0m |
|[2m [0m[2m  437[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgz2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mgz[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mgz[0m[40m                          [0m |
|[2m [0m[2m  438[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  439[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_K2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40max2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mgz2[0m[37;40m)[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m |
|[2m [0m[2m  440[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_GA[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mgz[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max[0m[37;40m)[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfl[0m |
|[2m [0m[2m  441[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_G2mA2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mgz2[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40max2[0m[37;40m)[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m |
|[2m [0m[2m  442[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  443[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mNX_half[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  444[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_invK2_sub[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m |
|[2m [0m[2m  445[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m  446[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_invK2_sub[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mN[0m |
|[2m [0m[2m  447[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  448[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# STEP3: per-step float/complex scratch[0m |
|[2m [0m[2m  449[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_ARG[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m |
|[2m [0m[2m  450[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_DEN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m |
|[2m [0m[2m  451[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_NUM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mempty[0m[37;40m([0m[37;40m([0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40mNX_half[0m |
|[2m [0m[2m  452[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  453[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# ix=0 branch mask (Z>=2 and GAMMA!=0),[0m |
|[2m [0m[2m  454[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_mask_ix0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_z_i[0m |
|[2m [0m[2m  455[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  456[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# DIVXZ = 1/(3NX/2 * 3NZ/2), constant f[0m |
|[2m [0m[2m  457[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX32[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.5[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40msta[0m |
|[2m [0m[2m  458[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ32[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.5[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40msta[0m |
|[2m [0m[2m  459[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mstate[0m[36;40m.[0m[37;40mstep3_divxz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40m([0m |
|[2m [0m[2m  460[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  461[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40mstate[0m[40m                           [0m |
|[2m [0m[2m  462[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  463[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  464[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Python/Numpy/Scipy port of dnsCudaPaoHost[0m |
|[2m [0m[2m  465[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  466[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_pao_host_init[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m:[0m[40m        [0m |
|[2m [0m[2m  467[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  468[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX[0m[40m                               [0m |
|[2m [0m[2m  469[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNE[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ[0m[40m                              [0m |
|[2m [0m[2m  470[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mND2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                           [0m |
|[2m [0m[2m  471[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNED2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNE[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                         [0m |
|[2m [0m[2m  472[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mPI[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m3.14159265358979[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m  473[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  474[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mDXZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m2.0[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mPI[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m |
|[2m [0m[2m  475[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mK0[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m  476[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNORM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mPI[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mK0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mK0[0m[40m                    [0m |
|[2m [0m[2m  477[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  478[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m--- INITIALIZING SciPy/CuPy ---[0m[31;40m"[0m |
|[2m [0m[2m  479[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m N=[0m[31;40m{[0m[37;40mN[0m[31;40m}[0m[31;40m, K0=[0m[31;40m{[0m[95;40mint[0m[37;40m([0m[37;40mK0[0m[37;40m)[0m[31;40m}[0m[31;40m, Re=[0m[31;40m{[0m[37;40mS[0m[36;40m.[0m[37;40mRe[0m[31;40m}[0m |
|[2m [0m[2m  480[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  481[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  482[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Build ALFA(N/2) and GAMMA(N)  (Fortra[0m |
|[2m [0m[2m  483[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  484[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40malfa[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40mND2[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  485[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40mNE[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  486[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  487[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mE1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m  488[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mE3[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mE1[0m[40m              [0m |
|[2m [0m[2m  489[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  490[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mDALFA[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mE1[0m[40m           [0m |
|[2m [0m[2m  491[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mDGAMMA[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mE3[0m[40m          [0m |
|[2m [0m[2m  492[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  493[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNED2[0m[37;40m)[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  494[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40malfa[0m[37;40m[[0m[37;40mx[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mx[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mDALFA[0m[40m    [0m |
|[2m [0m[2m  495[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  496[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.0[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m  497[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40mNED2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m  498[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mgamma[0m[37;40m[[0m[37;40mz[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mz[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mDGAMMA[0m[40m  [0m |
|[2m [0m[2m  499[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mgamma[0m[37;40m[[0m[37;40mNE[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mz[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[36;40m-[0m[37;40mgamma[0m[37;40m[[0m[37;40mz[0m[37;40m][0m[40m          [0m |
|[2m [0m[2m  500[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  501[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  502[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Host spectral UR: complex field UR(kx[0m |
|[2m [0m[2m  503[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# comp=0 â†’ u1, comp=1 â†’ u3 (Fortran[0m |
|[2m [0m[2m  504[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m#[0m[40m                                      [0m |
|[2m [0m[2m  505[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m#   UR[x,z,c]  where  x âˆˆ [0..ND2-1],[0m |
|[2m [0m[2m  506[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  507[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mND2[0m[37;40m,[0m[37;40m [0m[37;40mNE[0m[37;40m,[0m[37;40m [0m[95;40m2[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mnp[0m[36;40m.[0m[37;40mco[0m |
|[2m [0m[2m  508[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  509[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  510[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Fortran random vector RANVEC(97)[0m[40m     [0m |
|[2m [0m[2m  511[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  512[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mseed[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m[[0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mseed_init[0m[37;40m)[0m[37;40m][0m[37;40m  [0m[34;40m# mimics ISE[0m |
|[2m [0m[2m  513[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mRANVEC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[95;40m97[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m |
|[2m [0m[2m  514[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  515[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# "warm-up" 97 calls[0m[40m                   [0m |
|[2m [0m[2m  516[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40m_[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m97[0m[37;40m)[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  517[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mfrand[0m[37;40m([0m[37;40mseed[0m[37;40m)[0m[40m                        [0m |
|[2m [0m[2m  518[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  519[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# fill RANVEC[0m[40m                          [0m |
|[2m [0m[2m  520[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mi[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m97[0m[37;40m)[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  521[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mRANVEC[0m[37;40m[[0m[37;40mi[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfrand[0m[37;40m([0m[37;40mseed[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m  522[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  523[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mdef[0m[37;40m [0m[37;40mrandom_from_vec[0m[37;40m([0m[37;40mr[0m[37;40m:[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[37;40mn[0m |
|[2m [0m[2m  524[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40midx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[95;40mfloat[0m[37;40m([0m[37;40mr[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[95;40m97.0[0m[37;40m)[0m[40m         [0m |
|[2m [0m[2m  525[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40midx[0m[37;40m [0m[36;40m<[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  526[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40midx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0[0m[40m                        [0m |
|[2m [0m[2m  527[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40midx[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m96[0m[37;40m:[0m[40m                       [0m |
|[2m [0m[2m  528[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40midx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m96[0m[40m                       [0m |
|[2m [0m[2m  529[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mv[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mRANVEC[0m[37;40m[[0m[37;40midx[0m[37;40m][0m[40m                    [0m |
|[2m [0m[2m  530[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mRANVEC[0m[37;40m[[0m[37;40midx[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mr[0m[40m                    [0m |
|[2m [0m[2m  531[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[37;40mv[0m[40m                           [0m |
|[2m [0m[2m  532[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  533[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  534[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Generate isotropic random spectrum (F[0m |
|[2m [0m[2m  535[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  536[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40mGenerate isotropic random spectr[0m |
|[2m [0m[2m  537[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNE[0m[37;40m)[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  538[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mz[0m[37;40m [0m[36;40m%[0m[37;40m [0m[95;40m1000[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  539[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40mz=[0m[31;40m{[0m[37;40mz[0m[31;40m}[0m[31;40m/[0m[31;40m{[0m[37;40mNE[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m  540[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  541[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mgz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mgamma[0m[37;40m[[0m[37;40mz[0m[37;40m][0m[40m                      [0m |
|[2m [0m[2m  542[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNED2[0m[37;40m)[0m[37;40m:[0m[40m              [0m |
|[2m [0m[2m  543[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mr[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfrand[0m[37;40m([0m[37;40mseed[0m[37;40m)[0m[40m                [0m |
|[2m [0m[2m  544[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mth[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m2.0[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mPI[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mran[0m |
|[2m [0m[2m  545[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  546[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mARG[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40mcos[0m[37;40m([0m[37;40mth[0m[37;40m)[0m[37;40m [0m[36;40m+[0m |
|[2m [0m[2m  547[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  548[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40malfa[0m[37;40m[[0m[37;40mx[0m[37;40m][0m[40m                   [0m |
|[2m [0m[2m  549[0m[2m [0m|[34m       [0m[34m [0m|[34m    3%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mK2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40max[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mgz[0m[37;40m [0m[36;40m*[0m[37;40m [0m |
|[2m [0m[2m  550[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mK[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[37;40mK2[0m[37;40m)[0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m |
|[2m [0m[2m  551[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  552[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mif[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m0.0[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  553[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[34;40m# ALFA(X) == 0: purely u1 m[0m |
|[2m [0m[2m  554[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m |
|[2m [0m[2m  555[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  556[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mABSU2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40mexp[0m[37;40m([0m[36;40m-[0m |
|[2m [0m[2m  557[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mamp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[37;40mAB[0m |
|[2m [0m[2m  558[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m |
|[2m [0m[2m  559[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40melse[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m  560[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mdenom[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40m([0m |
|[2m [0m[2m  561[0m[2m [0m|[34m       [0m[34m [0m|[34m    1%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mABSW2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40mexp[0m[37;40m([0m[36;40m-[0m |
|[2m [0m[2m  562[0m[2m [0m|[34m       [0m[34m [0m|[34m    1%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mampw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[37;40mA[0m |
|[2m [0m[2m  563[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  564[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[37;40mampw[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mAR[0m |
|[2m [0m[2m  565[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mu[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[36;40m-[0m[37;40m [0m[37;40m([0m[37;40mgz[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40max[0m |
|[2m [0m[2m  566[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  567[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mw[0m[40m            [0m |
|[2m [0m[2m  568[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mu[0m[40m            [0m |
|[2m [0m[2m  569[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  570[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Special zero modes (UR(1,1,1)=0, UR(1[0m |
|[2m [0m[2m  571[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[95;40m0.0[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.0[0m[37;40mj[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  572[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[95;40m0.0[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.0[0m[37;40mj[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  573[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  574[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  575[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Hermitian symmetry in Z (Fortran DO 6[0m |
|[2m [0m[2m  576[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  577[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40mNED2[0m[37;40m)[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  578[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mNE[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mconj[0m[37;40m([0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m |
|[2m [0m[2m  579[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mNE[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mconj[0m[37;40m([0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m |
|[2m [0m[2m  580[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  581[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Zero at Z=NED2+1 (index NED2 in 0-bas[0m |
|[2m [0m[2m  582[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40mNED2[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.0[0m[37;40mj[0m[40m            [0m |
|[2m [0m[2m  583[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40mNED2[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.0[0m[37;40mj[0m[40m            [0m |
|[2m [0m[2m  584[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  585[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  586[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Compute averages A(1..7), E110, Q2, W[0m |
|[2m [0m[2m  587[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  588[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mA1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA3[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA4[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA5[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA6[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA7[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m [0m |
|[2m [0m[2m  589[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mE110[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                             [0m |
|[2m [0m[2m  590[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  591[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40mCompute averages A(1..7), E110, [0m |
|[2m [0m[2m  592[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mND2[0m[37;40m)[0m[37;40m:[0m[40m                   [0m |
|[2m [0m[2m  593[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mx1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mx[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m0[0m[37;40m)[0m[40m                      [0m |
|[2m [0m[2m  594[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40max2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40malfa[0m[37;40m[[0m[37;40mx[0m[37;40m][0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40malfa[0m[37;40m[[0m[37;40mx[0m |
|[2m [0m[2m  595[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  596[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNE[0m[37;40m)[0m[37;40m:[0m[40m                [0m |
|[2m [0m[2m  597[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mU1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[40m               [0m |
|[2m [0m[2m  598[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mU3[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[40m               [0m |
|[2m [0m[2m  599[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  600[0m[2m [0m|[34m       [0m[34m [0m|[34m    1%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mu1u1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40mabs[0m[37;40m([0m[37;40mU1[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[36;40m*[0m[37;40m [0m[95;40m2[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  601[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mu3u3[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mnp[0m[36;40m.[0m[37;40mabs[0m[37;40m([0m[37;40mU3[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[36;40m*[0m[37;40m [0m[95;40m2[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  602[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  603[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mgz2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mgamma[0m[37;40m[[0m[37;40mz[0m[37;40m][0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mg[0m |
|[2m [0m[2m  604[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mK2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40max2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mgz2[0m[40m                 [0m |
|[2m [0m[2m  605[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mm[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[37;40m [0m[33;40mif[0m[37;40m [0m[37;40mx1[0m[37;40m [0m[33;40melse[0m[37;40m [0m[95;40m2.0[0m[40m         [0m |
|[2m [0m[2m  606[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  607[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA1[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu1u1[0m[40m                 [0m |
|[2m [0m[2m  608[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA2[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu3u3[0m[40m                 [0m |
|[2m [0m[2m  609[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA3[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu1u1[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max2[0m[40m           [0m |
|[2m [0m[2m  610[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA4[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu1u1[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mgz2[0m[40m           [0m |
|[2m [0m[2m  611[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA5[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu3u3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max2[0m[40m           [0m |
|[2m [0m[2m  612[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA6[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu3u3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mgz2[0m[40m           [0m |
|[2m [0m[2m  613[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mA7[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40m([0m[37;40mu1u1[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mu3u3[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mK2[0m[37;40m [0m[36;40m*[0m[37;40m [0m |
|[2m [0m[2m  614[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  615[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mif[0m[37;40m [0m[37;40mx1[0m[37;40m:[0m[40m                         [0m |
|[2m [0m[2m  616[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mE110[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mu1u1[0m[40m               [0m |
|[2m [0m[2m  617[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  618[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mQ2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA1[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mA2[0m[40m                           [0m |
|[2m [0m[2m  619[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mW2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mA3[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mA4[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mA5[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mA6[0m[40m                 [0m |
|[2m [0m[2m  620[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvisc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[37;40mQ2[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mQ2[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40m([0m[95;40mfloat[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mRe[0m[37;40m)[0m |
|[2m [0m[2m  621[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  622[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mvisc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mvisc[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m  623[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  624[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  625[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Extra diagnostics (Fortran WRITE bloc[0m |
|[2m [0m[2m  626[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  627[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mEP[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mW2[0m[40m                         [0m |
|[2m [0m[2m  628[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mDe[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA7[0m[40m            [0m |
|[2m [0m[2m  629[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mKOL[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mEP[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[36;40m*[0m[37;40m [0m[95;40m0.25[0m |
|[2m [0m[2m  630[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNLAM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                             [0m |
|[2m [0m[2m  631[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mE110[0m[37;40m [0m[36;40m!=[0m[37;40m [0m[95;40m0.0[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  632[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mNLAM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA1[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mE110[0m[40m             [0m |
|[2m [0m[2m  633[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  634[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40ma11[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA1[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mQ2[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1.0[0m[40m              [0m |
|[2m [0m[2m  635[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40me11[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40m([0m[37;40mA3[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mA4[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mW2[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1.0[0m[40m       [0m |
|[2m [0m[2m  636[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mtscale[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.5[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mQ2[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mEP[0m[40m                 [0m |
|[2m [0m[2m  637[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdxKol[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mDXZ[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mKOL[0m[40m               [0m |
|[2m [0m[2m  638[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mLux[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA[0m |
|[2m [0m[2m  639[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mLuz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA[0m |
|[2m [0m[2m  640[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mLwx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA[0m |
|[2m [0m[2m  641[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mLwz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[95;40m2.0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mA[0m |
|[2m [0m[2m  642[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCeps2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.5[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mQ2[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mDe[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40m([0m[37;40mEP[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mEP[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m  643[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  644[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Print diagnostics exactly like the CU[0m |
|[2m [0m[2m  645[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m N           =[0m[31;40m{[0m[37;40mN[0m[31;40m:[0m[31;40m12.0f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m  646[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Reynolds n. =[0m[31;40m{[0m[95;40mfloat[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mRe[0m[37;40m)[0m[31;40m:[0m[31;40m12.1[0m |
|[2m [0m[2m  647[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m K0          =[0m[31;40m{[0m[37;40mK0[0m[31;40m:[0m[31;40m12.0f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  648[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Energy      =[0m[31;40m{[0m[37;40mQ2[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  649[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m WiWi        =[0m[31;40m{[0m[37;40mW2[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  650[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Epsilon     =[0m[31;40m{[0m[37;40mEP[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  651[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m a11         =[0m[31;40m{[0m[37;40ma11[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  652[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m e11         =[0m[31;40m{[0m[37;40me11[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  653[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Time scale  =[0m[31;40m{[0m[37;40mtscale[0m[31;40m:[0m[31;40m12.4g[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  654[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Kolmogorov  =[0m[31;40m{[0m[37;40mKOL[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  655[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Viscosity   =[0m[31;40m{[0m[37;40mvisc[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m  656[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m dx/Kol.     =[0m[31;40m{[0m[37;40mdxKol[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  657[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m 2Pi/Nlamda  =[0m[31;40m{[0m[37;40mNLAM[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m  658[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m 2Pi/Lux     =[0m[31;40m{[0m[37;40mLux[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  659[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m 2Pi/Luz     =[0m[31;40m{[0m[37;40mLuz[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  660[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m 2Pi/Lwx     =[0m[31;40m{[0m[37;40mLwx[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  661[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m 2Pi/Lwz     =[0m[31;40m{[0m[37;40mLwz[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  662[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Deps.       =[0m[31;40m{[0m[37;40mDe[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  663[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Ceps2       =[0m[31;40m{[0m[37;40mCeps2[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  664[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m E1          =[0m[31;40m{[0m[95;40mfloat[0m[37;40m([0m[37;40mE1[0m[37;40m)[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m |
|[2m [0m[2m  665[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m E3          =[0m[31;40m{[0m[95;40mfloat[0m[37;40m([0m[37;40mE3[0m[37;40m)[0m[31;40m:[0m[31;40m12.4f[0m[31;40m}[0m |
|[2m [0m[2m  666[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m PAO seed    =[0m[31;40m{[0m[37;40mseed[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[31;40m:[0m[31;40m12d[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  667[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  668[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  669[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Reshuffle (Fortran DO 1000 block)[0m[40m    [0m |
|[2m [0m[2m  670[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  671[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mcomp[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m2[0m[37;40m)[0m[37;40m:[0m[40m                  [0m |
|[2m [0m[2m  672[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNED2[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1[0m[37;40m,[0m[37;40m [0m[36;40m-[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[36;40m-[0m[95;40m1[0m[37;40m)[0m[37;40m:[0m[40m  [0m |
|[2m [0m[2m  673[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mND2[0m[37;40m)[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m  674[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[34;40m# UR(X,N-NED2+Z,I) = UR(X,Z[0m |
|[2m [0m[2m  675[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mNED2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[37;40mcomp[0m[37;40m][0m[37;40m [0m[36;40m=[0m |
|[2m [0m[2m  676[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  677[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[34;40m# IF(Z.LE.(N-NE)) UR(X,Z+NE[0m |
|[2m [0m[2m  678[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[33;40mif[0m[37;40m [0m[37;40mz[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mN[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mNE[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m:[0m[40m      [0m |
|[2m [0m[2m  679[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                    [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mNED2[0m[37;40m,[0m[37;40m [0m[37;40mcomp[0m[37;40m][0m[37;40m [0m[36;40m=[0m |
|[2m [0m[2m  680[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  681[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  682[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Scatter spectral UR â†’ compact UC(kx[0m |
|[2m [0m[2m  683[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m#   UC: (NK, NE, 3) on host, but DnsSta[0m |
|[2m [0m[2m  684[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  685[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK[0m[40m                              [0m |
|[2m [0m[2m  686[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC_host[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNK[0m[37;40m,[0m[37;40m [0m[37;40mNE[0m[37;40m,[0m[37;40m [0m[95;40m3[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mn[0m |
|[2m [0m[2m  687[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  688[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNE[0m[37;40m)[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  689[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mND2[0m[37;40m)[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  690[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mfor[0m[37;40m [0m[37;40mc[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m2[0m[37;40m)[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m  691[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUC_host[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[37;40mc[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m |
|[2m [0m[2m  692[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  693[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# ALSO build full 3/2-grid UC_full (For[0m |
|[2m [0m[2m  694[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[40m                    [0m |
|[2m [0m[2m  695[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                    [0m |
|[2m [0m[2m  696[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  697[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC_full_host[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNK_full[0m[37;40m,[0m[37;40m [0m[37;40mNZ_fu[0m |
|[2m [0m[2m  698[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mfor[0m[37;40m [0m[37;40mz[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNE[0m[37;40m)[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m  699[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mx[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mND2[0m[37;40m)[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  700[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mfor[0m[37;40m [0m[37;40mc[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m2[0m[37;40m)[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m  701[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUC_full_host[0m[37;40m[[0m[37;40mx[0m[37;40m,[0m[37;40m [0m[37;40mz[0m[37;40m,[0m[37;40m [0m[37;40mc[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m |
|[2m [0m[2m  702[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  703[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m PAO initialization OK. VISC=[0m[31;40m{[0m[95;40mf[0m |
|[2m [0m[2m  704[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  705[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  706[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Move alfa/gamma/UC/UC_full into DnsSt[0m |
|[2m [0m[2m  707[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  708[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40malfa[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40malfa[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mxp[0m[36;40m.[0m[37;40mfloa[0m |
|[2m [0m[2m  709[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mgamma[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mgamma[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mxp[0m[36;40m.[0m[37;40mfl[0m |
|[2m [0m[2m  710[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  711[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# compact UC: host (NK, NE, 3) â†’ xp ([0m |
|[2m [0m[2m  712[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC_xp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mUC_host[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m  713[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40muc[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mtranspose[0m[37;40m([0m[37;40mUC_xp[0m[37;40m,[0m[37;40m [0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m,[0m[37;40m [0m |
|[2m [0m[2m  714[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  715[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# full UC_full: host (NK_full, NZ_full,[0m |
|[2m [0m[2m  716[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC_full_xp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mUC_full_host[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  717[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mtranspose[0m[37;40m([0m[37;40mUC_full_x[0m |
|[2m [0m[2m  718[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  719[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  720[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Build initial UR_full & om2 from UC_f[0m |
|[2m [0m[2m  721[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# -------------------------------------[0m |
|[2m [0m[2m  722[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Inverse transform UC_full â†’ UR_full[0m |
|[2m [0m[2m  723[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvfft_full_inverse_uc_full_to_ur_full[0m[37;40m([0m[37;40mS[0m[37;40m)[0m |
|[2m [0m[2m  724[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  725[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Spectral vorticity from UC_full, like[0m |
|[2m [0m[2m  726[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdns_calcom_from_uc_full[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m  727[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  728[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# No history yet[0m[40m                       [0m |
|[2m [0m[2m  729[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mfnm1[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros_like[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mom2[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  730[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  731[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  732[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  733[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# FFT helpers (vfft_full_* equivalents)[0m[40m    [0m |
|[2m [0m[2m  734[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  735[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  736[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mvfft_full_inverse_uc_full_to_ur_full[0m[37;40m([0m[37;40mS[0m[37;40m:[0m |
|[2m [0m[2m  737[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  738[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[40m                         [0m |
|[2m [0m[2m  739[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft[0m[40m                            [0m |
|[2m [0m[2m  740[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  741[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mraise[0m[37;40m [0m[1;90;40mRuntimeError[0m[37;40m([0m[31;40m"[0m[31;40mscipy.fft is no[0m |
|[2m [0m[2m  742[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  743[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m                   [0m |
|[2m [0m[2m  744[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  745[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m  746[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ_ful[0m |
|[2m [0m[2m  747[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m  748[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mplan[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft_plan_irfft2_uc01[0m[40m      [0m |
|[2m [0m[2m  749[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mplan[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  750[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mwith[0m[37;40m [0m[37;40mplan[0m[37;40m:[0m[40m                     [0m |
|[2m [0m[2m  751[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m |
|[2m [0m[2m  752[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m  753[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ[0m |
|[2m [0m[2m  754[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  755[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mur01[0m[37;40m,[0m |
|[2m [0m[2m  756[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.0[0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m  757[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  758[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  759[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mvfft_full_forward_ur_full_to_uc_full[0m[37;40m([0m[37;40mS[0m[37;40m:[0m |
|[2m [0m[2m  760[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  761[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    UR_full (3, NZ_full, NX_full) â†’ UC_fu[0m |
|[2m [0m[2m  762[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  763[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Correct forward:[0m[40m                       [0m |
|[2m [0m[2m  764[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      1) real FFT along x      (real â†’ co[0m |
|[2m [0m[2m  765[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      2) FFT along z           (complex â†’[0m |
|[2m [0m[2m  766[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  767[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    ONLY CHANGE: use rfft2 on (z,x) axes.[0m[40m  [0m |
|[2m [0m[2m  768[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  769[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# S.ur_full is already float32[0m[40m         [0m |
|[2m [0m[2m  770[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[40m                         [0m |
|[2m [0m[2m  771[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft[0m[40m                            [0m |
|[2m [0m[2m  772[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  773[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mraise[0m[37;40m [0m[1;90;40mRuntimeError[0m[37;40m([0m[31;40m"[0m[31;40mscipy.fft is no[0m |
|[2m [0m[2m  774[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  775[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m  776[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[34;40m# overwrite_x is safe here (UR_full[0m |
|[2m [0m[2m  777[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mrfft2[0m[37;40m([0m[37;40mUR[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mS[0m[36;40m.[0m |
|[2m [0m[2m  778[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m  779[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mplan[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft_plan_rfft2_ur_full[0m[40m    [0m |
|[2m [0m[2m  780[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mplan[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m  781[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mwith[0m[37;40m [0m[37;40mplan[0m[37;40m:[0m[40m                     [0m |
|[2m [0m[2m  782[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mrfft2[0m[37;40m([0m[37;40mUR[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ_[0m |
|[2m [0m[2m  783[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m  784[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mrfft2[0m[37;40m([0m[37;40mUR[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m |
|[2m [0m[2m  785[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  786[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Assign back; uc_full is complex64, as[0m |
|[2m [0m[2m  787[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUC[0m[40m                    [0m |
|[2m [0m[2m  788[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  789[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  790[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  791[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# CALCOM â€” spectral vorticity from UC_ful[0m |
|[2m [0m[2m  792[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  793[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  794[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_calcom_from_uc_full[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m |
|[2m [0m[2m  795[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  796[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Python/xp port of dnsCudaCalcom:[0m[40m       [0m |
|[2m [0m[2m  797[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  798[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      OM2(ix,iz) = i * [ GAMMA(iz)*UC1(ix,i[0m |
|[2m [0m[2m  799[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  800[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Uses:[0m[40m                                  [0m |
|[2m [0m[2m  801[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      S.uc_full : (3, NZ_full, NK_full)  [c[0m |
|[2m [0m[2m  802[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      S.alfa    : (NX_half,)[0m[40m               [0m |
|[2m [0m[2m  803[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      S.gamma   : (NZ,)[0m[40m                    [0m |
|[2m [0m[2m  804[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Writes:[0m[40m                                [0m |
|[2m [0m[2m  805[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      S.om2     : (NZ, NX_half)[0m[40m            [0m |
|[2m [0m[2m  806[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  807[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  808[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  809[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNbase[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m  810[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[37;40m)[0m[40m               [0m |
|[2m [0m[2m  811[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[37;40m)[0m[40m               [0m |
|[2m [0m[2m  812[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[37;40m)[0m[40m               [0m |
|[2m [0m[2m  813[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  814[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNbase[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                   [0m |
|[2m [0m[2m  815[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNbase[0m[40m                             [0m |
|[2m [0m[2m  816[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  817[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40malfa_1d[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40malfa[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[37;40m    [0m |
|[2m [0m[2m  818[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma_1d[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mgamma[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[37;40m  [0m |
|[2m [0m[2m  819[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  820[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# UC_full layout: [comp, z, kx][0m[40m        [0m |
|[2m [0m[2m  821[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc1_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m                [0m |
|[2m [0m[2m  822[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc2_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[37;40m[[0m[95;40m1[0m[37;40m][0m[37;40m                [0m |
|[2m [0m[2m  823[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  824[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# We only use the first NZ rows and NX_[0m |
|[2m [0m[2m  825[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40muc1_full[0m[37;40m[[0m[37;40m:[0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m          [0m |
|[2m [0m[2m  826[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40muc2_full[0m[37;40m[[0m[37;40m:[0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m          [0m |
|[2m [0m[2m  827[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  828[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40malfa_1d[0m[37;40m[[0m[33;40mNone[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m                  [0m |
|[2m [0m[2m  829[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mgamma_1d[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[33;40mNone[0m[37;40m][0m[37;40m                 [0m |
|[2m [0m[2m  830[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  831[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# diff = GAMMA*UC1 - ALFA*UC2[0m[40m          [0m |
|[2m [0m[2m  832[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdiff[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mgz[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40muc1[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40muc2[0m[37;40m             [0m |
|[2m [0m[2m  833[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  834[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# om = i * diff = (-Im(diff), Re(diff))[0m |
|[2m [0m[2m  835[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdiff_r[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mdiff[0m[36;40m.[0m[37;40mreal[0m[40m                     [0m |
|[2m [0m[2m  836[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdiff_i[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mdiff[0m[36;40m.[0m[37;40mimag[0m[40m                     [0m |
|[2m [0m[2m  837[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  838[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mom_r[0m[37;40m [0m[36;40m=[0m[37;40m [0m[36;40m-[0m[37;40mdiff_i[0m[40m                         [0m |
|[2m [0m[2m  839[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mom_i[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mdiff_r[0m[40m                          [0m |
|[2m [0m[2m  840[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  841[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mom2[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mom_r[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[37;40mj[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mom_[0m |
|[2m [0m[2m  842[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  843[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  844[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  845[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# STEP2B â€” build uiuj and forward FFT (dn[0m |
|[2m [0m[2m  846[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  847[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_step2b[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m       [0m |
|[2m [0m[2m  848[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[31;40m"""[0m[40m                                    [0m |
|[2m [0m[2m  849[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Python/CuPy port of dnsCudaStep2B(DnsDe[0m |
|[2m [0m[2m  850[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  851[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    Mirrors Fortran STEP2B:[0m[40m                [0m |
|[2m [0m[2m  852[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  853[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      1) Build uiuj in UR(x,z,1..3) on the [0m |
|[2m [0m[2m  854[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      2) Full-grid forward FFT: UR_full â†’[0m |
|[2m [0m[2m  855[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m         (VRFFTF + VCFFTF in Fortran)[0m[40m      [0m |
|[2m [0m[2m  856[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m      3) Zero UC(X,NZ+1,I) for X<=NX/2, I=1[0m |
|[2m [0m[2m  857[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[31;40m    """[0m[40m                                    [0m |
|[2m [0m[2m  858[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  859[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  860[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Geometry on the full 3/2 grid[0m[40m        [0m |
|[2m [0m[2m  861[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[37;40m          [0m[34;40m# NX = NZ = Nbase [0m |
|[2m [0m[2m  862[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[37;40m        [0m[34;40m# 3*N/2[0m[40m     [0m |
|[2m [0m[2m  863[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[37;40m        [0m[34;40m# 3*N/2[0m[40m     [0m |
|[2m [0m[2m  864[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[37;40m        [0m[34;40m# 3*N/4+1[0m[40m   [0m |
|[2m [0m[2m  865[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  866[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUR[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[40m                         [0m |
|[2m [0m[2m  867[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[40m                         [0m |
|[2m [0m[2m  868[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  869[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mu[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m   [0m[34;40m# (NZ_full, NX_full)[0m[40m       [0m |
|[2m [0m[2m  870[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUR[0m[37;40m[[0m[95;40m1[0m[37;40m][0m[37;40m   [0m[34;40m# (NZ_full, NX_full)[0m[40m       [0m |
|[2m [0m[2m  871[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  872[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[34;40m# Use in-place multiplies to avoid temp[0m |
|[2m [0m[2m  873[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mu[0m[37;40m,[0m[37;40m [0m[37;40mw[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mUR[0m[37;40m[[0m[95;40m2[0m[37;40m][0m[37;40m)[0m[37;40m  [0m[34;40m# u * w[0m[40m  [0m |
|[2m [0m[2m  874[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mu[0m[37;40m,[0m[37;40m [0m[37;40mu[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mUR[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m)[0m[37;40m  [0m[34;40m# u^2[0m[40m    [0m |
|[2m [0m[2m  875[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mw[0m[37;40m,[0m[37;40m [0m[37;40mw[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mUR[0m[37;40m[[0m[95;40m1[0m[37;40m][0m[37;40m)[0m[37;40m  [0m[34;40m# w^2[0m[40m    [0m |
|[2m [0m[2m  876[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  877[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvfft_full_forward_ur_full_to_uc_full[0m[37;40m([0m[37;40mS[0m[37;40m)[0m |
|[2m [0m[2m  878[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  879[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                       [0m |
|[2m [0m[2m  880[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                                 [0m |
|[2m [0m[2m  881[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mz_mid[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNZ[0m[40m                             [0m |
|[2m [0m[2m  882[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  883[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mkx_max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mmin[0m[37;40m([0m[37;40mNX_half[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m)[0m[40m         [0m |
|[2m [0m[2m  884[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  885[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mz_mid[0m[37;40m [0m[36;40m<[0m[37;40m [0m[37;40mNZ_full[0m[37;40m [0m[33;40mand[0m[37;40m [0m[37;40mkx_max[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[40m     [0m |
|[2m [0m[2m  886[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m3[0m[37;40m,[0m[37;40m [0m[37;40mz_mid[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[37;40mkx_max[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mcompl[0m |
|[2m [0m[2m  887[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  888[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  889[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  890[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# STEP3 â€” vorticity update using om2 & fn[0m |
|[2m [0m[2m  891[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m  892[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_step3[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m        [0m |
|[2m [0m[2m  893[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  894[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  895[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mom2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mom2[0m[40m                            [0m |
|[2m [0m[2m  896[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfnm1[0m[40m                          [0m |
|[2m [0m[2m  897[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40malfa[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40malfa[0m[40m                          [0m |
|[2m [0m[2m  898[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mgamma[0m[40m                        [0m |
|[2m [0m[2m  899[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[40m                    [0m |
|[2m [0m[2m  900[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  901[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNbase[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m  902[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNbase[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                   [0m |
|[2m [0m[2m  903[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNbase[0m[40m                             [0m |
|[2m [0m[2m  904[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  905[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mvisc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mvisc[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m  906[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdt[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m  907[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcn[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mcn[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m  908[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mcnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mcnm1[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m  909[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  910[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mz_spec[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_z_spec[0m[40m                [0m |
|[2m [0m[2m  911[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mdivxz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_divxz[0m[40m                  [0m |
|[2m [0m[2m  912[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mGA[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_GA[0m[40m                        [0m |
|[2m [0m[2m  913[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mG2mA2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_G2mA2[0m[40m                  [0m |
|[2m [0m[2m  914[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_K2[0m[40m                        [0m |
|[2m [0m[2m  915[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  916[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc0_low[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40muc_full[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[40m      [0m |
|[2m [0m[2m  917[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc1_low[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40muc_full[0m[37;40m[[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[40m      [0m |
|[2m [0m[2m  918[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc2_low[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40muc_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[40m      [0m |
|[2m [0m[2m  919[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  920[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc1_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_uc1_th[0m[40m                [0m |
|[2m [0m[2m  921[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc2_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_uc2_th[0m[40m                [0m |
|[2m [0m[2m  922[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc3_th[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_uc3_th[0m[40m                [0m |
|[2m [0m[2m  923[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mtake[0m[37;40m([0m[37;40muc0_low[0m[37;40m,[0m[37;40m [0m[37;40mz_spec[0m[37;40m,[0m[37;40m [0m[37;40maxis[0m[36;40m=[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40muc[0m |
|[2m [0m[2m  924[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mtake[0m[37;40m([0m[37;40muc1_low[0m[37;40m,[0m[37;40m [0m[37;40mz_spec[0m[37;40m,[0m[37;40m [0m[37;40maxis[0m[36;40m=[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40muc[0m |
|[2m [0m[2m  925[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mtake[0m[37;40m([0m[37;40muc2_low[0m[37;40m,[0m[37;40m [0m[37;40mz_spec[0m[37;40m,[0m[37;40m [0m[37;40maxis[0m[36;40m=[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40muc[0m |
|[2m [0m[2m  926[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  927[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mtmp_FN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mscratch1[0m[40m                    [0m |
|[2m [0m[2m  928[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mtmp_c[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mscratch2[0m[40m                     [0m |
|[2m [0m[2m  929[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40msubtract[0m[37;40m([0m[37;40muc1_th[0m[37;40m,[0m[37;40m [0m[37;40muc2_th[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_FN[0m[37;40m)[0m |
|[2m [0m[2m  930[0m[2m [0m|[34m       [0m[34m [0m|[34m    1%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mtmp_FN[0m[37;40m,[0m[37;40m [0m[37;40mGA[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_FN[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m  931[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40muc3_th[0m[37;40m,[0m[37;40m [0m[37;40mG2mA2[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_c[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  932[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40madd[0m[37;40m([0m[37;40mtmp_FN[0m[37;40m,[0m[37;40m [0m[37;40mtmp_c[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_FN[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m  933[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mtmp_FN[0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40mdivxz[0m[40m                        [0m |
|[2m [0m[2m  934[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  935[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mVT[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.5[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mvisc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mdt[0m[40m       [0m |
|[2m [0m[2m  936[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mARG[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_ARG[0m[40m                      [0m |
|[2m [0m[2m  937[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mDEN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_DEN[0m[40m                      [0m |
|[2m [0m[2m  938[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mK2[0m[37;40m,[0m[37;40m [0m[37;40mVT[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mARG[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m  939[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40madd[0m[37;40m([0m[37;40mARG[0m[37;40m,[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mDEN[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  940[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  941[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mc2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.5[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mdt[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m |
|[2m [0m[2m  942[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mc3[0m[37;40m [0m[36;40m=[0m[37;40m [0m[36;40m-[0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.5[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mdt[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mcnm1[0m[40m      [0m |
|[2m [0m[2m  943[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  944[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNUM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_NUM[0m[40m                      [0m |
|[2m [0m[2m  945[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNUM[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mom2[0m[40m                         [0m |
|[2m [0m[2m  946[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mom2[0m[37;40m,[0m[37;40m [0m[37;40mARG[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_c[0m[37;40m)[0m[40m       [0m |
|[2m [0m[2m  947[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNUM[0m[37;40m [0m[36;40m-[0m[36;40m=[0m[37;40m [0m[37;40mtmp_c[0m[40m                           [0m |
|[2m [0m[2m  948[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  949[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mtmp_FN[0m[37;40m,[0m[37;40m [0m[37;40mc2[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_c[0m[37;40m)[0m[40m     [0m |
|[2m [0m[2m  950[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNUM[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mtmp_c[0m[40m                           [0m |
|[2m [0m[2m  951[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mmultiply[0m[37;40m([0m[37;40mfnm1[0m[37;40m,[0m[37;40m [0m[37;40mc3[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp_c[0m[37;40m)[0m[40m       [0m |
|[2m [0m[2m  952[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNUM[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mtmp_c[0m[40m                           [0m |
|[2m [0m[2m  953[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  954[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mdivide[0m[37;40m([0m[37;40mNUM[0m[37;40m,[0m[37;40m [0m[37;40mDEN[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mom2[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m  955[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  956[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfnm1[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mtmp_FN[0m[40m                     [0m |
|[2m [0m[2m  957[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  958[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mout1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mscratch1[0m[40m                      [0m |
|[2m [0m[2m  959[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mout2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mscratch2[0m[40m                      [0m |
|[2m [0m[2m  960[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mout1[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0[0m[40m                          [0m |
|[2m [0m[2m  961[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mout2[0m[37;40m[[0m[36;40m.[0m[36;40m.[0m[36;40m.[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0[0m[40m                          [0m |
|[2m [0m[2m  962[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  963[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mNX_half[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m  964[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40minvK2_sub[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_invK2_sub[0m[40m      [0m |
|[2m [0m[2m  965[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  966[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout1[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mom2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[40m           [0m |
|[2m [0m[2m  967[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout1[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40minvK2_sub[0m[40m           [0m |
|[2m [0m[2m  968[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout1[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40mgamma[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[33;40mNone[0m[37;40m][0m[40m      [0m |
|[2m [0m[2m  969[0m[2m [0m|[34m       [0m[34m [0m|[34m    2%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout1[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[36;40m-[0m[95;40m1.0[0m[37;40mj[0m[37;40m)[0m[40m [0m |
|[2m [0m[2m  970[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  971[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mom2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[40m           [0m |
|[2m [0m[2m  972[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40minvK2_sub[0m[40m           [0m |
|[2m [0m[2m  973[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40malfa[0m[37;40m[[0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m[[0m[33;40mNone[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m   [0m |
|[2m [0m[2m  974[0m[2m [0m|[34m       [0m[34m [0m|[34m    1%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mout2[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[95;40m1.0[0m[37;40mj[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m  975[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  976[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mout1[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0[0m[40m                         [0m |
|[2m [0m[2m  977[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mmask0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mstep3_mask_ix0[0m[40m               [0m |
|[2m [0m[2m  978[0m[2m [0m|[1;31m    6%[0m[34m [0m[34m [0m|[1;31m   24%[0m[34m [0m|[34m   3% [0m[34m [0m|[37;40m    [0m[37;40mout1[0m[37;40m[[0m[37;40mmask0[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mcomplex64[0m[37;40m([0m[36;40m-[0m[95;40m1.0[0m[37;40mj[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m |
|[2m [0m[2m  979[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  980[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_full[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mout1[0m[40m       [0m |
|[2m [0m[2m  981[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_full[0m[37;40m[[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mout2[0m[40m       [0m |
|[2m [0m[2m  982[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  983[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mcnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mcn[0m[37;40m)[0m[40m                     [0m |
|[2m [0m[2m  984[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  985[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  986[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  987[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# STEP2A core (dealias + reshuffle + invers[0m |
|[2m [0m[2m  988[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m  989[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_step2a[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m       [0m |
|[2m [0m[2m  990[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m  991[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[40m                            [0m |
|[2m [0m[2m  992[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX[0m[40m                              [0m |
|[2m [0m[2m  993[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ[0m[40m                              [0m |
|[2m [0m[2m  994[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[40m                    [0m |
|[2m [0m[2m  995[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                    [0m |
|[2m [0m[2m  996[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[40m                    [0m |
|[2m [0m[2m  997[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m  998[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40muc_full[0m[40m                         [0m |
|[2m [0m[2m  999[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1000[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhi_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                      [0m |
|[2m [0m[2m 1001[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhi_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mmin[0m[37;40m([0m[95;40m3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m4[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m 1002[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mhi_start[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[37;40mhi_end[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1003[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40mhi_start[0m[37;40m:[0m[37;40mhi_end[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mx[0m |
|[2m [0m[2m 1004[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1005[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhalfN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                         [0m |
|[2m [0m[2m 1006[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mk_max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mmin[0m[37;40m([0m[37;40mhalfN[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m 1007[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mk_max[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m 1008[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_mid_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mhalfN[0m[40m                [0m |
|[2m [0m[2m 1009[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_mid_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                      [0m |
|[2m [0m[2m 1010[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_top_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                    [0m |
|[2m [0m[2m 1011[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_top_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mhalfN[0m[40m              [0m |
|[2m [0m[2m 1012[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40mz_top_start[0m[37;40m:[0m[37;40mz_top_end[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mk_m[0m |
|[2m [0m[2m 1013[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40mz_mid_start[0m[37;40m:[0m[37;40mz_mid_end[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mk_m[0m |
|[2m [0m[2m 1014[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1015[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft[0m[40m                            [0m |
|[2m [0m[2m 1016[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m 1017[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mraise[0m[37;40m [0m[1;90;40mRuntimeError[0m[37;40m([0m[31;40m"[0m[31;40mscipy.fft is no[0m |
|[2m [0m[2m 1018[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1019[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mUC01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mUC[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m                   [0m |
|[2m [0m[2m 1020[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1021[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1022[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mNZ_full[0m[37;40m,[0m |
|[2m [0m[2m 1023[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m 1024[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mplan[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft_plan_irfft2_uc01[0m[40m      [0m |
|[2m [0m[2m 1025[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mplan[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m               [0m |
|[2m [0m[2m 1026[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mwith[0m[37;40m [0m[37;40mplan[0m[37;40m:[0m[40m                     [0m |
|[2m [0m[2m 1027[0m[2m [0m|[34m       [0m[34m [0m|[34m    2%[0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m |
|[2m [0m[2m 1028[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m 1029[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mur01[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40mUC01[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mNZ_f[0m |
|[2m [0m[2m 1030[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1031[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mur01[0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[37;40mNZ_full[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNX_full[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m 1032[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1033[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m0[0m[37;40m:[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mur01[0m[40m            [0m |
|[2m [0m[2m 1034[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m0.0[0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m 1035[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1036[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40moff_x[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mNX_full[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mNX[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m            [0m |
|[2m [0m[2m 1037[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40moff_z[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mNZ_full[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mNZ[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m            [0m |
|[2m [0m[2m 1038[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1039[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m0[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40moff_z[0m[37;40m:[0m[37;40moff_[0m |
|[2m [0m[2m 1040[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40moff_z[0m[37;40m:[0m[37;40moff_[0m |
|[2m [0m[2m 1041[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[95;40m2[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                    [0m |
|[2m [0m[2m 1042[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1043[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1044[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1045[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# NEXTDT â€” CFL based timestep[0m[40m            [0m |
|[2m [0m[2m 1046[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1047[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1048[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mcompute_cflm[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m 1049[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m 1050[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1051[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX3D2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[40m                      [0m |
|[2m [0m[2m 1052[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ3D2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                      [0m |
|[2m [0m[2m 1053[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1054[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mu[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNZ3D2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX3D2[0m[37;40m][0m[40m       [0m |
|[2m [0m[2m 1055[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNZ3D2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX3D2[0m[37;40m][0m[40m       [0m |
|[2m [0m[2m 1056[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1057[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mtmp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mcfl_tmp[0m[37;40m[[0m[37;40m:[0m[37;40mNZ3D2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX3D2[0m[37;40m][0m[40m        [0m |
|[2m [0m[2m 1058[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mabsw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mcfl_absw[0m[37;40m[[0m[37;40m:[0m[37;40mNZ3D2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX3D2[0m[37;40m][0m[40m      [0m |
|[2m [0m[2m 1059[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1060[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mabs[0m[37;40m([0m[37;40mu[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp[0m[37;40m)[0m[40m                     [0m |
|[2m [0m[2m 1061[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40mabs[0m[37;40m([0m[37;40mw[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mabsw[0m[37;40m)[0m[40m                    [0m |
|[2m [0m[2m 1062[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[36;40m.[0m[37;40madd[0m[37;40m([0m[37;40mtmp[0m[37;40m,[0m[37;40m [0m[37;40mabsw[0m[37;40m,[0m[37;40m [0m[37;40mout[0m[36;40m=[0m[37;40mtmp[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m 1063[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1064[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFLM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mmax[0m[37;40m([0m[37;40mtmp[0m[37;40m)[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40minv_dx[0m[40m          [0m |
|[2m [0m[2m 1065[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1066[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mCFLM[0m[37;40m)[0m[40m                 [0m |
|[2m [0m[2m 1067[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1068[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40mCFLM[0m[40m                            [0m |
|[2m [0m[2m 1069[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1070[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1071[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mnext_dt[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m          [0m |
|[2m [0m[2m 1072[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mPI[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[40m                           [0m |
|[2m [0m[2m 1073[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFLM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mcompute_cflm[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                 [0m |
|[2m [0m[2m 1074[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1075[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1076[0m[2m [0m|[34m    4% [0m[34m [0m|[34m   19%[0m[34m [0m|[34m   3% [0m[34m [0m|[37;40m        [0m[37;40mCFLM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mCFLM[0m[37;40m)[0m[37;40m  [0m[34;40m# one sync here[0m |
|[2m [0m[2m 1077[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1078[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mCFLM[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[37;40m [0m[33;40mor[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[37;40m:[0m[40m         [0m |
|[2m [0m[2m 1079[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[40m                             [0m |
|[2m [0m[2m 1080[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1081[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFL[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mCFLM[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mPI[0m[40m                 [0m |
|[2m [0m[2m 1082[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mcn[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.8[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.2[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mcflnum[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mCFL[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m 1083[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mcn[0m[40m                     [0m |
|[2m [0m[2m 1084[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1085[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1086[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m 1087[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Python equivalent of dnsCudaDumpFieldAsPG[0m |
|[2m [0m[2m 1088[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# =========================================[0m |
|[2m [0m[2m 1089[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdump_field_as_pgm_full[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m,[0m[37;40m [0m[37;40mcom[0m |
|[2m [0m[2m 1090[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[40m                    [0m |
|[2m [0m[2m 1091[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                    [0m |
|[2m [0m[2m 1092[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1093[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1094[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mur_full_host[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_np[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mur_ful[0m |
|[2m [0m[2m 1095[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m 1096[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mur_full_host[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_np[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mur_ful[0m |
|[2m [0m[2m 1097[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1098[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfield[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mur_full_host[0m[37;40m[[0m[37;40mcomp[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m       [0m |
|[2m [0m[2m 1099[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1100[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mminv[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mfield[0m[36;40m.[0m[37;40mmin[0m[37;40m([0m[37;40m)[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m 1101[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mmaxv[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mfield[0m[36;40m.[0m[37;40mmax[0m[37;40m([0m[37;40m)[0m[37;40m)[0m[40m              [0m |
|[2m [0m[2m 1102[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1103[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mtry[0m[37;40m:[0m[40m                                   [0m |
|[2m [0m[2m 1104[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mf[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mopen[0m[37;40m([0m[37;40mfilename[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mwb[0m[31;40m"[0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m 1105[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mexcept[0m[37;40m [0m[1;90;40mOSError[0m[37;40m [0m[33;40mas[0m[37;40m [0m[37;40me[0m[37;40m:[0m[40m                   [0m |
|[2m [0m[2m 1106[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m[DUMP] fopen failed for [0m[31;40m{[0m[37;40mfi[0m |
|[2m [0m[2m 1107[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mreturn[0m[40m                             [0m |
|[2m [0m[2m 1108[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1109[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mheader[0m[37;40m [0m[36;40m=[0m[37;40m [0m[31;40mf[0m[31;40m"[0m[31;40mP5[0m[31;40m\n[0m[31;40m{[0m[37;40mNX_full[0m[31;40m}[0m[31;40m [0m[31;40m{[0m[37;40mNZ_full[0m[31;40m}[0m[31;40m\n[0m[31;40m255[0m |
|[2m [0m[2m 1110[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mf[0m[36;40m.[0m[37;40mwrite[0m[37;40m([0m[37;40mheader[0m[36;40m.[0m[37;40mencode[0m[37;40m([0m[31;40m"[0m[31;40mascii[0m[31;40m"[0m[37;40m)[0m[37;40m)[0m[40m        [0m |
|[2m [0m[2m 1111[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1112[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mrng[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mmaxv[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mminv[0m[40m                      [0m |
|[2m [0m[2m 1113[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1114[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[95;40mabs[0m[37;40m([0m[37;40mrng[0m[37;40m)[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[95;40m1.0e-12[0m[37;40m:[0m[40m                [0m |
|[2m [0m[2m 1115[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mc[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mbytes[0m[37;40m([0m[37;40m[[0m[95;40m128[0m[37;40m][0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m 1116[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mrow[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mc[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNX_full[0m[40m                  [0m |
|[2m [0m[2m 1117[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40m_[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNZ_full[0m[37;40m)[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m 1118[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mf[0m[36;40m.[0m[37;40mwrite[0m[37;40m([0m[37;40mrow[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m 1119[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m 1120[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mj[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNZ_full[0m[37;40m)[0m[37;40m:[0m[40m           [0m |
|[2m [0m[2m 1121[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mfor[0m[37;40m [0m[37;40mi[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[37;40mNX_full[0m[37;40m)[0m[37;40m:[0m[40m       [0m |
|[2m [0m[2m 1122[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mval[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mfield[0m[37;40m[[0m[37;40mj[0m[37;40m,[0m[37;40m [0m[37;40mi[0m[37;40m][0m[37;40m)[0m[40m   [0m |
|[2m [0m[2m 1123[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mnorm[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mval[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mminv[0m[37;40m)[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mrng[0m[40m  [0m |
|[2m [0m[2m 1124[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mpixf[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mnorm[0m[37;40m [0m[36;40m*[0m[37;40m [0m[95;40m254.0[0m[40m  [0m |
|[2m [0m[2m 1125[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mpix[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40mpixf[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m0.5[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m 1126[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[33;40mif[0m[37;40m [0m[37;40mpix[0m[37;40m [0m[36;40m<[0m[37;40m [0m[95;40m1[0m[37;40m:[0m[40m                [0m |
|[2m [0m[2m 1127[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                    [0m[37;40mpix[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1[0m[40m                [0m |
|[2m [0m[2m 1128[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[33;40mif[0m[37;40m [0m[37;40mpix[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m255[0m[37;40m:[0m[40m              [0m |
|[2m [0m[2m 1129[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                    [0m[37;40mpix[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m255[0m[40m              [0m |
|[2m [0m[2m 1130[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[37;40mf[0m[36;40m.[0m[37;40mwrite[0m[37;40m([0m[95;40mbytes[0m[37;40m([0m[37;40m[[0m[37;40mpix[0m[37;40m][0m[37;40m)[0m[37;40m)[0m[40m      [0m |
|[2m [0m[2m 1131[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1132[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mf[0m[36;40m.[0m[37;40mclose[0m[37;40m([0m[37;40m)[0m[40m                              [0m |
|[2m [0m[2m 1133[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m[DUMP] Wrote [0m[31;40m{[0m[37;40mfilename[0m[31;40m}[0m[31;40m (PGM, [0m[31;40m{[0m |
|[2m [0m[2m 1134[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m          [0m[31;40mf[0m[31;40m"[0m[31;40mcomp=[0m[31;40m{[0m[37;40mcomp[0m[31;40m}[0m[31;40m, min=[0m[31;40m{[0m[37;40mminv[0m[31;40m:[0m[31;40mg[0m[31;40m}[0m[31;40m, max=[0m |
|[2m [0m[2m 1135[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1136[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1137[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1138[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Helpers for visualization fields (energy,[0m |
|[2m [0m[2m 1139[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1140[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1141[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_kinetic[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m      [0m |
|[2m [0m[2m 1142[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m 1143[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1144[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mu[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m0[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m                 [0m |
|[2m [0m[2m 1145[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mw[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m                 [0m |
|[2m [0m[2m 1146[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1147[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mke[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40msqrt[0m[37;40m([0m[37;40mu[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mu[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mw[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mw[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m 1148[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mke[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat[0m |
|[2m [0m[2m 1149[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1150[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1151[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40m_spectral_band_to_phys_full_grid[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDns[0m |
|[2m [0m[2m 1152[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m 1153[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1154[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[40m                            [0m |
|[2m [0m[2m 1155[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNX_full[0m[40m                    [0m |
|[2m [0m[2m 1156[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNZ_full[0m[40m                    [0m |
|[2m [0m[2m 1157[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNK_full[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNK_full[0m[40m                    [0m |
|[2m [0m[2m 1158[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1159[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                       [0m |
|[2m [0m[2m 1160[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                                 [0m |
|[2m [0m[2m 1161[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1162[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_tmp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mzeros[0m[37;40m([0m[37;40m([0m[37;40mNZ_full[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m)[0m[37;40m,[0m[37;40m [0m[37;40md[0m |
|[2m [0m[2m 1163[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40muc_tmp[0m[37;40m[[0m[37;40m:[0m[37;40mNZ[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mband[0m[40m           [0m |
|[2m [0m[2m 1164[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1165[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhi_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                      [0m |
|[2m [0m[2m 1166[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhi_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mmin[0m[37;40m([0m[95;40m3[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m4[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m [0m[36;40m-[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m 1167[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mhi_start[0m[37;40m [0m[36;40m<[0m[36;40m=[0m[37;40m [0m[37;40mhi_end[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1168[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40muc_tmp[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40mhi_start[0m[37;40m:[0m[37;40mhi_end[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m |
|[2m [0m[2m 1169[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1170[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mhalfN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                         [0m |
|[2m [0m[2m 1171[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mk_max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mmin[0m[37;40m([0m[37;40mhalfN[0m[37;40m,[0m[37;40m [0m[37;40mNK_full[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m 1172[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1173[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mk_max[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m0[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m 1174[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_mid_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mhalfN[0m[40m                [0m |
|[2m [0m[2m 1175[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_mid_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mhalfN[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mhalfN[0m[40m          [0m |
|[2m [0m[2m 1176[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_top_start[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                    [0m |
|[2m [0m[2m 1177[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mz_top_end[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mhalfN[0m[40m              [0m |
|[2m [0m[2m 1178[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1179[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40muc_tmp[0m[37;40m[[0m[37;40mz_top_start[0m[37;40m:[0m[37;40mz_top_end[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mk_ma[0m |
|[2m [0m[2m 1180[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40muc_tmp[0m[37;40m[[0m[37;40mz_mid_start[0m[37;40m:[0m[37;40mz_mid_end[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mk_ma[0m |
|[2m [0m[2m 1181[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1182[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mz_mid[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mNZ[0m[40m                             [0m |
|[2m [0m[2m 1183[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mz_mid[0m[37;40m [0m[36;40m<[0m[37;40m [0m[37;40mNZ_full[0m[37;40m:[0m[40m                    [0m |
|[2m [0m[2m 1184[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40muc_tmp[0m[37;40m[[0m[37;40mz_mid[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40mNX_half[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mcomple[0m |
|[2m [0m[2m 1185[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1186[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mfft[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mfft[0m[40m                            [0m |
|[2m [0m[2m 1187[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                        [0m |
|[2m [0m[2m 1188[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mraise[0m[37;40m [0m[1;90;40mRuntimeError[0m[37;40m([0m[31;40m"[0m[31;40mscipy.fft is no[0m |
|[2m [0m[2m 1189[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1190[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1191[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mphys[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40muc_tmp[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mNZ_ful[0m |
|[2m [0m[2m 1192[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m 1193[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mphys[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mfft[0m[36;40m.[0m[37;40mirfft2[0m[37;40m([0m[37;40muc_tmp[0m[37;40m,[0m[37;40m [0m[37;40ms[0m[36;40m=[0m[37;40m([0m[37;40mNZ_ful[0m |
|[2m [0m[2m 1194[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1195[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mphys[0m[37;40m [0m[36;40m*[0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mNZ_full[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mNX_full[0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m 1196[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mreturn[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40masarray[0m[37;40m([0m[37;40mphys[0m[37;40m,[0m[37;40m [0m[37;40mdtype[0m[36;40m=[0m[37;40mxp[0m[36;40m.[0m[37;40mfloat3[0m |
|[2m [0m[2m 1197[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1198[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1199[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_om2_phys[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m     [0m |
|[2m [0m[2m 1200[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mband[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mom2[0m[40m                           [0m |
|[2m [0m[2m 1201[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mphys[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_spectral_band_to_phys_full_grid[0m |
|[2m [0m[2m 1202[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mphys[0m[40m              [0m |
|[2m [0m[2m 1203[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1204[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1205[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mdns_stream_func[0m[37;40m([0m[37;40mS[0m[37;40m:[0m[37;40m [0m[37;40mDnsState[0m[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m  [0m |
|[2m [0m[2m 1206[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mxp[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mxp[0m[40m                              [0m |
|[2m [0m[2m 1207[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1208[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mNbase[0m[40m                            [0m |
|[2m [0m[2m 1209[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNX_half[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[37;40m [0m[36;40m/[0m[36;40m/[0m[37;40m [0m[95;40m2[0m[40m                       [0m |
|[2m [0m[2m 1210[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mNZ[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mN[0m[40m                                 [0m |
|[2m [0m[2m 1211[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1212[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40malfa_1d[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40malfa[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[40m    [0m |
|[2m [0m[2m 1213[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgamma_1d[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mgamma[0m[36;40m.[0m[37;40mastype[0m[37;40m([0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m)[0m[40m  [0m |
|[2m [0m[2m 1214[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1215[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40max[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40malfa_1d[0m[37;40m[[0m[33;40mNone[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[40m                  [0m |
|[2m [0m[2m 1216[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mgz[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mgamma_1d[0m[37;40m[[0m[37;40m:[0m[37;40m,[0m[37;40m [0m[33;40mNone[0m[37;40m][0m[40m                 [0m |
|[2m [0m[2m 1217[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1218[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40max[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mgz[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mgz[0m[40m                 [0m |
|[2m [0m[2m 1219[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK2[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mK2[0m[37;40m [0m[36;40m+[0m[37;40m [0m[37;40mxp[0m[36;40m.[0m[37;40mfloat32[0m[37;40m([0m[95;40m1.0e-30[0m[37;40m)[0m[40m          [0m |
|[2m [0m[2m 1220[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1221[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mphi_hat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mom2[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40mK2[0m[40m                   [0m |
|[2m [0m[2m 1222[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mphys[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_spectral_band_to_phys_full_grid[0m |
|[2m [0m[2m 1223[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[36;40m.[0m[37;40mur_full[0m[37;40m[[0m[95;40m2[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m,[0m[37;40m [0m[37;40m:[0m[37;40m][0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mphys[0m[40m              [0m |
|[2m [0m[2m 1224[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1225[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1226[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1227[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# Main driver (Python version of main in dn[0m |
|[2m [0m[2m 1228[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[34;40m# -----------------------------------------[0m |
|[2m [0m[2m 1229[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mrun_dns[0m[37;40m([0m[40m                               [0m |
|[2m [0m[2m 1230[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m8[0m[37;40m,[0m[40m                            [0m |
|[2m [0m[2m 1231[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mRe[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m100[0m[37;40m,[0m[40m                       [0m |
|[2m [0m[2m 1232[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK0[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m10.0[0m[37;40m,[0m[40m                      [0m |
|[2m [0m[2m 1233[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mSTEPS[0m[37;40m:[0m[37;40m [0m[95;40mint[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m2[0m[37;40m,[0m[40m                        [0m |
|[2m [0m[2m 1234[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFL[0m[37;40m:[0m[37;40m [0m[95;40mfloat[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.75[0m[37;40m,[0m[40m                     [0m |
|[2m [0m[2m 1235[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mbackend[0m[37;40m:[0m[37;40m [0m[37;40mLiteral[0m[37;40m[[0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[37;40m][0m[37;40m [0m |
|[2m [0m[2m 1236[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m)[0m[37;40m [0m[36;40m-[0m[36;40m>[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m                                 [0m |
|[2m [0m[2m 1237[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m--- RUN DNS ---[0m[31;40m"[0m[37;40m)[0m[40m               [0m |
|[2m [0m[2m 1238[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m N   = [0m[31;40m{[0m[37;40mN[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m 1239[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Re  = [0m[31;40m{[0m[37;40mRe[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m 1240[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m K0  = [0m[31;40m{[0m[37;40mK0[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m 1241[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Steps = [0m[31;40m{[0m[37;40mSTEPS[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m 1242[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m CFL  = [0m[31;40m{[0m[37;40mCFL[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m                [0m |
|[2m [0m[2m 1243[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m requested = [0m[31;40m{[0m[37;40mbackend[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m       [0m |
|[2m [0m[2m 1244[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1245[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mS[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mcreate_dns_state[0m[37;40m([0m[37;40mN[0m[36;40m=[0m[37;40mN[0m[37;40m,[0m[37;40m [0m[37;40mRe[0m[36;40m=[0m[37;40mRe[0m[37;40m,[0m[37;40m [0m[37;40mK0[0m[36;40m=[0m[37;40mK0[0m[37;40m,[0m |
|[2m [0m[2m 1246[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m effective = [0m[31;40m{[0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[31;40m}[0m[31;40m (xp = [0m |
|[2m [0m[2m 1247[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1248[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m [0m[33;40mand[0m[37;40m [0m[37;40m_spfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m |
|[2m [0m[2m 1249[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mfft_ctx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m_spfft[0m[36;40m.[0m[37;40mset_workers[0m[37;40m([0m[37;40mS[0m[36;40m.[0m[37;40mfft_[0m |
|[2m [0m[2m 1250[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40melse[0m[37;40m:[0m[40m                                  [0m |
|[2m [0m[2m 1251[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mfft_ctx[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mnullcontext[0m[37;40m([0m[37;40m)[0m[40m            [0m |
|[2m [0m[2m 1252[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1253[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mwith[0m[37;40m [0m[37;40mfft_ctx[0m[37;40m:[0m[40m                          [0m |
|[2m [0m[2m 1254[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40m_spfft[0m[37;40m [0m[33;40mis[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40mNone[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m 1255[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m scipy.fft workers in-c[0m |
|[2m [0m[2m 1256[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m 1257[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[95;40mprint[0m[37;40m([0m[31;40m"[0m[31;40m scipy.fft workers in-co[0m |
|[2m [0m[2m 1258[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1259[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mdns_step2a[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                      [0m |
|[2m [0m[2m 1260[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1261[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mCFLM[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mcompute_cflm[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m             [0m |
|[2m [0m[2m 1262[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mif[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mbackend[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m:[0m[40m             [0m |
|[2m [0m[2m 1263[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mCFLM0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40mCFLM[0m[37;40m)[0m[37;40m  [0m[34;40m# one sync[0m |
|[2m [0m[2m 1264[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40melse[0m[37;40m:[0m[40m                              [0m |
|[2m [0m[2m 1265[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mCFLM0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mCFLM[0m[40m                   [0m |
|[2m [0m[2m 1266[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1267[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mcflnum[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40m([0m[37;40mCFLM0[0m[37;40m [0m[36;40m*[0m[37;40m [0m[37;40mmath[0m[36;40m.[0m[37;40mpi[0m[37;40m)[0m |
|[2m [0m[2m 1268[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40mcn[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m1.0[0m[40m                         [0m |
|[2m [0m[2m 1269[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40mcnm1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                       [0m |
|[2m [0m[2m 1270[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40mt[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40m0.0[0m[40m                          [0m |
|[2m [0m[2m 1271[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1272[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m [NEXTDT INIT] CFLM=[0m[31;40m{[0m[37;40mCFLM[0m[31;40m:[0m[31;40m1[0m |
|[2m [0m[2m 1273[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Initial DT=[0m[31;40m{[0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[31;40m:[0m[31;40m11.7f[0m[31;40m}[0m[31;40m CN[0m |
|[2m [0m[2m 1274[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1275[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40msync[0m[37;40m([0m[37;40m)[0m[40m                           [0m |
|[2m [0m[2m 1276[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mt0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mtime[0m[36;40m.[0m[37;40mperf_counter[0m[37;40m([0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m 1277[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1278[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[33;40mfor[0m[37;40m [0m[37;40mit[0m[37;40m [0m[33;40min[0m[37;40m [0m[95;40mrange[0m[37;40m([0m[95;40m1[0m[37;40m,[0m[37;40m [0m[37;40mSTEPS[0m[37;40m [0m[36;40m+[0m[37;40m [0m[95;40m1[0m[37;40m)[0m[37;40m:[0m[40m     [0m |
|[2m [0m[2m 1279[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mS[0m[36;40m.[0m[37;40mit[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mit[0m[40m                      [0m |
|[2m [0m[2m 1280[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1281[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mdt_old[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mS[0m[36;40m.[0m[37;40mdt[0m[40m                  [0m |
|[2m [0m[2m 1282[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1283[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mdns_step2b[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m 1284[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mdns_step3[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                   [0m |
|[2m [0m[2m 1285[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mdns_step2a[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                  [0m |
|[2m [0m[2m 1286[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1287[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mnext_dt[0m[37;40m([0m[37;40mS[0m[37;40m)[0m[40m                     [0m |
|[2m [0m[2m 1288[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[37;40mS[0m[36;40m.[0m[37;40mt[0m[37;40m [0m[36;40m+[0m[36;40m=[0m[37;40m [0m[37;40mdt_old[0m[40m                  [0m |
|[2m [0m[2m 1289[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1290[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m            [0m[33;40mif[0m[37;40m [0m[37;40m([0m[37;40mit[0m[37;40m [0m[36;40m%[0m[37;40m [0m[95;40m100[0m[37;40m)[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m0[0m[37;40m [0m[33;40mor[0m[37;40m [0m[37;40mit[0m[37;40m [0m[36;40m==[0m[37;40m [0m[95;40m1[0m[37;40m [0m[33;40mo[0m |
|[2m [0m[2m 1291[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m                [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m ITERATION [0m[31;40m{[0m[37;40mit[0m[31;40m:[0m[31;40m6d[0m[31;40m}[0m[31;40m [0m |
|[2m [0m[2m 1292[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1293[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mS[0m[36;40m.[0m[37;40msync[0m[37;40m([0m[37;40m)[0m[40m                           [0m |
|[2m [0m[2m 1294[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mt1[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mtime[0m[36;40m.[0m[37;40mperf_counter[0m[37;40m([0m[37;40m)[0m[40m           [0m |
|[2m [0m[2m 1295[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1296[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40melap[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40mt1[0m[37;40m [0m[36;40m-[0m[37;40m [0m[37;40mt0[0m[40m                     [0m |
|[2m [0m[2m 1297[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mfps[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40m([0m[37;40mSTEPS[0m[37;40m [0m[36;40m/[0m[37;40m [0m[37;40melap[0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[37;40melap[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m0[0m[37;40m [0m[33;40mel[0m |
|[2m [0m[2m 1298[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1299[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Elapsed CPU time for [0m[31;40m{[0m[37;40mSTEP[0m |
|[2m [0m[2m 1300[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m Final T=[0m[31;40m{[0m[37;40mS[0m[36;40m.[0m[37;40mt[0m[31;40m:[0m[31;40m8g[0m[31;40m}[0m[31;40m  CN=[0m[31;40m{[0m[37;40mS[0m[36;40m.[0m[37;40mcn[0m |
|[2m [0m[2m 1301[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[95;40mprint[0m[37;40m([0m[31;40mf[0m[31;40m"[0m[31;40m FPS = [0m[31;40m{[0m[37;40mfps[0m[31;40m:[0m[31;40m7g[0m[31;40m}[0m[31;40m"[0m[37;40m)[0m[40m          [0m |
|[2m [0m[2m 1302[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1303[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mdef[0m[37;40m [0m[37;40mmain[0m[37;40m([0m[37;40m)[0m[37;40m:[0m[40m                                [0m |
|[2m [0m[2m 1304[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40margs[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40msys[0m[36;40m.[0m[37;40margv[0m[37;40m[[0m[95;40m1[0m[37;40m:[0m[37;40m][0m[40m                    [0m |
|[2m [0m[2m 1305[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mN[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40margs[0m[37;40m[[0m[95;40m0[0m[37;40m][0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m0[0m[37;40m [0m[33;40melse[0m[37;40m [0m |
|[2m [0m[2m 1306[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mRe[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40margs[0m[37;40m[[0m[95;40m1[0m[37;40m][0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m1[0m[37;40m [0m[33;40mel[0m |
|[2m [0m[2m 1307[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mK0[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40margs[0m[37;40m[[0m[95;40m2[0m[37;40m][0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m2[0m[37;40m [0m[33;40mel[0m |
|[2m [0m[2m 1308[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mSTEPS[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mint[0m[37;40m([0m[37;40margs[0m[37;40m[[0m[95;40m3[0m[37;40m][0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m3[0m[37;40m [0m[33;40me[0m |
|[2m [0m[2m 1309[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mCFL[0m[37;40m [0m[36;40m=[0m[37;40m [0m[95;40mfloat[0m[37;40m([0m[37;40margs[0m[37;40m[[0m[95;40m4[0m[37;40m][0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m4[0m[37;40m [0m[33;40me[0m |
|[2m [0m[2m 1310[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1311[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mBACK[0m[37;40m [0m[36;40m=[0m[37;40m [0m[37;40margs[0m[37;40m[[0m[95;40m5[0m[37;40m][0m[36;40m.[0m[37;40mlower[0m[37;40m([0m[37;40m)[0m[37;40m [0m[33;40mif[0m[37;40m [0m[95;40mlen[0m[37;40m([0m[37;40margs[0m[37;40m)[0m[37;40m [0m[36;40m>[0m[37;40m [0m[95;40m5[0m |
|[2m [0m[2m 1312[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[33;40mif[0m[37;40m [0m[37;40mBACK[0m[37;40m [0m[33;40mnot[0m[37;40m [0m[33;40min[0m[37;40m [0m[37;40m([0m[31;40m"[0m[31;40mcpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mgpu[0m[31;40m"[0m[37;40m,[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[37;40m)[0m[37;40m:[0m[40m [0m |
|[2m [0m[2m 1313[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m        [0m[37;40mBACK[0m[37;40m [0m[36;40m=[0m[37;40m [0m[31;40m"[0m[31;40mauto[0m[31;40m"[0m[40m                      [0m |
|[2m [0m[2m 1314[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1315[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mrun_dns[0m[37;40m([0m[37;40mN[0m[36;40m=[0m[37;40mN[0m[37;40m,[0m[37;40m [0m[37;40mRe[0m[36;40m=[0m[37;40mRe[0m[37;40m,[0m[37;40m [0m[37;40mK0[0m[36;40m=[0m[37;40mK0[0m[37;40m,[0m[37;40m [0m[37;40mSTEPS[0m[36;40m=[0m[37;40mSTEPS[0m[37;40m,[0m |
|[2m [0m[2m 1316[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1317[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[40m                                           [0m |
|[2m [0m[2m 1318[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[33;40mif[0m[37;40m [0m[36;40m__name__[0m[37;40m [0m[36;40m==[0m[37;40m [0m[31;40m"[0m[31;40m__main__[0m[31;40m"[0m[37;40m:[0m[40m                 [0m |
|[2m [0m[2m 1319[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40m    [0m[37;40mmain[0m[37;40m([0m[37;40m)[0m[40m                                 [0m |
|[2m [0m[2m     [0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|                                            |
|-------+--------+-------+-------+--------------------------------------------|
|[2m [0m[2m     [0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[1;3mfunction summary for C:\Users\tobbe\python…[0m |
|[2m [0m[2m   79[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40mfrand[0m[40m                                      [0m |
|[2m [0m[2m  466[0m[2m [0m|[34m    2% [0m[34m [0m|[34m   13%[0m[34m [0m|[34m      [0m[34m [0m|[37;40mdns_pao_host_init[0m[40m                          [0m |
|[2m [0m[2m  523[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40mdns_pao_host_init[0m[36;40m.[0m[36;40m<[0m[95;40mlocals[0m[36;40m>[0m[36;40m.[0m[37;40mrandom_from_vec[0m[40m [0m |
|[2m [0m[2m  759[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40mvfft_full_forward_ur_full_to_uc_full[0m[40m       [0m |
|[2m [0m[2m  847[0m[2m [0m|[34m       [0m[34m [0m|[34m    2%[0m[34m [0m|[34m      [0m[34m [0m|[37;40mdns_step2b[0m[40m                                 [0m |
|[2m [0m[2m  892[0m[2m [0m|[1;31m    8%[0m[34m [0m[34m [0m|[1;31m   33%[0m[34m [0m|[34m   5% [0m[34m [0m|[37;40mdns_step3[0m[40m                                  [0m |
|[2m [0m[2m  989[0m[2m [0m|[34m    1% [0m[34m [0m|[34m    4%[0m[34m [0m|[34m      [0m[34m [0m|[37;40mdns_step2a[0m[40m                                 [0m |
|[2m [0m[2m 1048[0m[2m [0m|[34m       [0m[34m [0m|[34m      [0m[34m [0m|[34m      [0m[34m [0m|[37;40mcompute_cflm[0m[40m                               [0m |
|[2m [0m[2m 1071[0m[2m [0m|[34m    5% [0m[34m [0m|[34m   19%[0m[34m [0m|[34m   3% [0m[34m [0m|[37;40mnext_dt[0m[40m                                    [0m |
+-----------------------------------------------------------------------------+
